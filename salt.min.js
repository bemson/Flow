/* Flow v0.5.0 + Panzer v0.3.10 + genData v3.1.0 | github.com/bemson | (c) 2014, MIT */
;!function(a,b,c){function f(a){return"function"==typeof a}function g(a){return"function"!=typeof a}function h(a){function w(a,b){this.name=a,this.value=b}if(this instanceof h)return this;var e,i,l,m,o,p,q,r,s,t,b=[["",a]],j=d.call(arguments),k=j.slice(1),n=k.filter(f),u=[],v=n.length;if(!v)return[];for(w.prototype=("function"==typeof this?this:h).prototype,l={returns:u,args:k.filter(g),params:j,loop:0,queued:0};b.length;){for(i=b.shift(),q=new w(i[0],i[1]),r=t=0,p=[i[0],i[1],i[2],l],l.continues=0,l.breaks=0,l.source=i[1];!l.continues&&v>r;)l.allowUndefined=0,o=n[r++].apply(q,p),(o!==c||l.allowUndefined)&&(m=o,t=1);if(t&&u.push(m),l.breaks)break;if("object"==typeof l.source){e=[];for(s in l.source)l.source.hasOwnProperty(s)&&e.push([s,l.source[s],q]);b=e.concat(b)}l.loop++,l.queued=b.length-1}return l.hasOwnProperty("returns")?l.returns:u}var d=a.prototype.slice;a.isArray||function(b){return b instanceof a},h.spawn=function i(){function c(e){return this instanceof c?this:a.apply("function"==typeof this?this:c,[e].concat(b,d.call(arguments).slice(1)))}var a=this,b=d.call(arguments).filter(f);return c.prototype=new a,c.spawn=i,c},h.version="3.1.0",b.genData=h}(Array,this);
!function(c,g,e,b,a,d,h){function f(k){var r={create:function(){var v={pkgs:[],pkgsIdx:{},KlassProxy:function(){},Klass:w};function w(y,x){if(!(this instanceof w)){throw new Error("Missing new operator.")}new m(v,this,y,typeof x==="object"?x:{})}w.prototype=v.KlassProxy.prototype;w.pkg=function(){return u.apply(v,arguments)};return w},version:"0.3.10"},s=(g||c)?k("genData"):d.genData,n=0,l=0,i=({}).toString(),o=s.spawn(function(x,H,I,A){var B=this,E=A.args[0],C=A.args[1],y=A.returns,w=C&&x&&(C.nf.some(z)||C.nr.some(F)),G=C&&x&&(C.af.some(z)||C.ar.some(F)),J,D,v=0;function z(K){return K.call(d,x,H)}function F(K){return K.test(x)}if(w||G){A.source=0;if(G){I.attrs[x]=H}}else{B.parentIndex=B.previousIndex=B.nextIndex=B.firstChildIndex=B.lastChildIndex=B.childIndex=B.ctx=B.lte=-1;B.index=y.push(B);B.depth=I?I.depth+1:1;B.name=x||"PROOT";B.attrs={};B.path=I?I.path+x+"/":"//";B.children=[];if(I){B.parentIndex=I.index;if(!I.children.length){I.firstChildIndex=B.index}B.childIndex=I.children.push(B.index)-1;I.lastChildIndex=B.index;if(B.childIndex){B.previousIndex=I.children[B.childIndex-1];y[B.previousIndex-1].nextIndex=B.index}}else{A.tree=H}if(I&&E&&E.pkgs.length){for(;D=E.pkgs[v];v++){if(typeof D.def.prepNode==="function"&&typeof(J=D.def.prepNode.call(d,A.source,A.tree))!=="undefined"){A.source=J}}}}}),t=s.spawn(function(w,z,x,v){var y=this,A;if(x){v.source=0;for(A in z){if(z.hasOwnProperty(A)&&A!=="lte"&&A!=="ctx"){y[A]=z[A]}}return y}}),q=/\w/;function m(D,x,w,z){var H=this,E={},C={},y={af:[],ar:[],nf:[],nr:[]},F,G,A,B;function v(I,J){if(I===D&&J<H.pkgs.length){return H.pkgs[J].inst}return i}for(F=0;A=D.pkgs[F];F++){if(typeof A.def.attrKey==="function"){y.af.push(A.def.attrKey)}else{if(A.def.attrKey instanceof a){y.ar.push(A.def.attrKey)}}if(typeof A.def.badKey==="function"){y.nf.push(A.def.badKey)}else{if(A.def.badKey instanceof a){y.nr.push(A.def.badKey)}}if(typeof A.def.prepTree==="function"&&typeof(B=A.def.prepTree.call(d,w))!=="undefined"){w=B}}H.nodes=o(w,D,y);H.nodes[0].parentIndex=H.nodes[0].childIndex=0;H.nodes.unshift(o()[0]);H.nodes[0].children.push(1);H.nodes[0].name="PNULL";H.nodes[0].index=H.nodes[0].depth=H.nodes[0].lte=0;H.nodes[0].path="..//";H.nodes[0].firstChildIndex=H.nodes[0].lastChildIndex=1;H.nodes[0].ctx=1;H.tank={id:n++,currentIndex:0,targetIndex:-1,go:function(I){var J=H.nodes[I];if(J){H.target=J;H.tank.targetIndex=J.index}H.stop=0;return H.go()},stop:function(){H.stop=1;return !!H.loop},post:function(I){var J=typeof I;if(H.loop){if(J==="function"){H.posts[++l]=I;return l}else{if(J==="number"){if(H.posts.hasOwnProperty(I)){delete H.posts[I];return true}}}}return false}};H.posts={};H.current=H.nodes[0];H.target=H.loop=0;H.pkgs=D.pkgs.map(function(I){var K=I.name,M=I.def,L={name:K,idx:I.idx,pkg:I,inst:new M()};function J(){}J.prototype=I.proxy.prototype;E[K]=L.proxy=new J();C[K]=L.inst;L.proxy.pkgs=E;L.proxy.toString=v;L.inst.pkgs=C;L.inst.tank=H.tank;L.inst.nodes=t.call(I.node,H.nodes);return L});for(F=0;A=H.pkgs[F];F++){A.inst.proxy=x}x.pkgs=E;x.toString=v;H.fire=j;for(F=0;A=H.pkgs[F];F++){if(typeof A.pkg.def.init==="function"){A.pkg.def.init.call(A.inst,z)}}delete H.fire}m.prototype={go:function(){var I=this,v=I.nodes,G=I.tank,w,z,B,y=0,H=I.stopped,A=I.current,E=H?A.lte:-1,F=-1,C=H?I.target.index:null,D,x;if(I.loop){return !!I.target}I.posts={};I.loop=1;I.fire("begin");while(I.loop){if((H||I.target)&&!I.stop){x=0;if(C!=I.target.index||!(~E|~F)){B=A.ctx===1;E=F=-1;C=I.target.index;z=C-A.index;if(z){if((z>0&&A.index<2)||!I.target.path.indexOf(A.path)){if(B){F=A.firstChildIndex}else{E=1}}else{if(B){E=2}else{if(I.target.path.indexOf(v[A.parentIndex].path)){z=-1}if(z>0){if(A.lte==3||A.lte==2){F=A.nextIndex}else{E=3}}else{if(A.lte==4||A.lte==2){F=~A.previousIndex?A.previousIndex:A.parentIndex}else{E=4}}}}}else{E=B?0:1}}else{if(~F){if(D){D=0;I.fire("release")}else{G.currentIndex=F;I.fire("node",F,A.index);A.lte=0;A=I.current=v[F];F=-1}}else{if(!D){D=1;I.fire("engage")}else{if(!B&&(E==1||E==2)){if(E==2){E=-1}else{B=A.ctx=1}I.fire("scope",A.ctx)}else{if(H){I.fire("traversing",E)}else{A.lte=E;if(!E){I.target=0;G.targetIndex=-1}I.fire("traverse",E)}y++;if(!I.stop){I.fire("traversed",E);I.stopped=0}I.stopped=I.stop;H=0;if(E==2){B=A.ctx=0}else{E=-1}}}}}}else{if(D){D=0;I.fire("release")}else{if(!x){x=1;I.fire("end")}else{I.loop=0}}}}for(w in I.posts){if(I.posts.hasOwnProperty(w)){I.posts[w].call(d)}}return y},fire:function(v){var x="on"+v.charAt(0).toUpperCase()+v.substr(1),w=arguments,A=0,z,y;for(;z=this.pkgs[A];A++){y=z.pkg.def[x];if(typeof y=="function"){y.apply(z.inst,w)}}}};function p(y,w){var v=this.pkgs[y-1],x;if(v&&w&&typeof w==="string"){x=new v.proxy();if(typeof x[w]==="function"){return x[w]}}return j}function u(w){var x=this,A;if(arguments.length){if(typeof w==="string"&&q.test(w)){if(!x.pkgsIdx.hasOwnProperty(w)){function z(B){if(B){return B instanceof x.pkgs[A].proxy&&B.toString(x,A)}}z.getSuper=function(B){return p.call(x,A,B)};z.init=z.attrKey=z.badKey=z.onBegin=z.onEnd=z.onNode=z.onEngage=z.onRelease=z.onScope=z.onTraverse=z.onTraversing=z.onTraversed=z.prepTree=z.prepNode=0;z.label=w;function v(){}v.prototype=new x.KlassProxy();x.Klass.prototype=z.proxy=v.prototype;x.KlassProxy=v;function y(){}z.node=y.prototype;A=z.index=x.pkgsIdx[w]=x.pkgs.push({name:w,idx:x.pkgs.length,def:z,proxy:v,node:y})-1}return x.pkgs[x.pkgsIdx[w]].def}return false}return x.pkgs.map(function(B){return B.name})}function j(){}return r}if(c){define(f)}else{if(g){module.exports=f(require)}else{if(!d.Panzer){d.Panzer=f()}}}}(typeof define=="function",typeof exports!="undefined",Array,Object,RegExp,this);
!function(a,b,c,d,e,f,g,h){function i(i){function S(a){return a instanceof j}function T(a,b,c){b&&(c?a.unshift(b):a.shift())}function U(){}function V(a,b,c){for(var f,g,d=c.nodes[c.tank.currentIndex],e=0,h=0;f=b[e];e++)g=f.tank.id,a.hasOwnProperty(g)||(h++,a[g]={inst:f,cap:d});return h}function W(a,b){for(var d,e,c=b.length,f=0;c--;)d=b[c],e=d.tank.id,a.hasOwnProperty(e)&&(f++,delete a[e]);return f}function X(a,b){var c,d,e,f,g,h,i,j,k=[];a:for(j in a)if(a.hasOwnProperty(j)){i=a[j],d=H;b:for(;d--;)if(c=G[d],f=b[c],h=f.length){for(g=0;h>g;g++)if(e=f[g],g>=f.made&&(e=f[g]=Z(c,e,typeof e),f.made++),e.f(i,e)){k[k.length]=i.inst;continue b}continue a}}return k}function Y(a){var b,c,d,e,g,i,j,k;if((null===a||a===h)&&(a=!1),i=typeof a,("object"!==i||!a.hasOwnProperty("is"))&&(q.hasOwnProperty("toJSON")&&(g=q.toJSON),q.toJSON=$,e="c"+JSON.stringify(a),g?q.toJSON=g:delete q.toJSON,F.hasOwnProperty(e)))return F[e];if(b={buffer:-1},"boolean"===i&&a)b.on=["/"],b.on.made=0;else if((j=a instanceof f)||"string"===i&&a||"number"===i&&a===~~a)b.on=[a],b.on.made=0;else if("object"===i&&!j)for(d=H;d--;)c=G[d],a.hasOwnProperty(c)&&(b[c]=s(a[c])?p.call(a[c]):[a[c]],b[c].made=0,k=1);for(d=H;d--;)c=G[d],b.hasOwnProperty(c)||(b[c]=m);return a.hasOwnProperty("buffer")&&(k||(b.on=["/"],b.on.made=0),-1!==a.buffer&&(b.buffer=a.buffer?1:0)),e&&(F[e]=b),b}function Z(a,b,c){var d=b instanceof f,e={v:b,f:U};return"has"===a?d?(e.f=bb,e.g=fb,e.m=B.test(b)?"pAry":"sAry"):b&&"string"===c?(e.g=fb,~b.indexOf("/")?(e.f=cb,e.m="pAry","/"!==e.v.charAt(0)&&(e.v="/"+e.v),"/"!==e.v.substr(-1)&&(e.v+="/")):(e.f=eb,e.m="sAry")):"number"===c&&b>=0&&b===~~b&&(e.f=ib):"from"===a?d?B.test(b)?(e.f=ab,e.g=jb):(e.f=bb,e.g=kb):b&&"string"===c?~b.indexOf("/")?(e.f=_,e.g=jb,"/"!==e.v.charAt(0)&&(e.v="/"+e.v),"/"!==e.v.substr(-1)&&(e.v+="/")):(e.f=eb,e.g=kb):"number"===c&&b>=0&&b===~~b&&(e.f=db,e.g=lb):"is"===a?e.f=hb:"on"===a?d?(e.f=ab,B.test(b)?(e.g=gb,e.m="path"):(e.g=gb,e.m="name")):b&&"string"===c?~b.indexOf("/")?(e.f=_,e.g=gb,e.m="path","/"!==e.v.charAt(0)&&(e.v="/"+e.v),"/"!==e.v.substr(-1)&&(e.v+="/")):(e.f=db,e.g=gb,e.m="name"):"number"===c&&b>=0&&b===~~b&&(e.f=db,e.g=gb,e.m="index"):"within"===a&&(d?B.test(b)?(e.f=ab,e.g=mb):(e.f=bb,e.g=nb):b&&"string"===c?~b.indexOf("/")?(e.f=_,e.g=mb,"/"!==e.v.charAt(0)&&(e.v="/"+e.v),"/"!==e.v.substr(-1)&&(e.v+="/")):(e.f=eb,e.g=nb):"number"===c&&b>-1&&b===~~b&&(e.f=ob)),e}function $(){return k+this}function _(a,b){return~b.g(a,b).indexOf(b.v)}function ab(a,b){return b.v.test(b.g(a,b))}function bb(a,b){for(var c=b.g(a,b),d=c.length,e=b.v;d--;)if(e.test(c[d]))return 1}function cb(a,b){for(var e,c=b.g(a,b),d=c.length,f=b.v;d--;)if(e=c[d],~e.indexOf(f))return 1}function db(a,b){return b.v===b.g(a,b)}function eb(a,b){for(var c=b.g(a,b),d=c.length,e=b.v;d--;)if(c[d]===e)return 1}function fb(a,b){return a.inst[b.m]}function gb(a,b){var c=a.inst;return c.nodes[c.tank.currentIndex][b.m]}function hb(a,b){return a.inst.nodes[1].value===b.v}function ib(a,b){return b.v<a.inst.nodes.length}function jb(a){return a.cap.path}function kb(a){var b=a.cap;return b.index>1?b.path.slice(2,-1).split("/"):m}function lb(a){return a.cap.index}function mb(a){var b=a.inst,c=b.nodes[b.tank.currentIndex];return~c.parentIndex?b.nodes[c.parentIndex].path:""}function nb(a){var b=a.inst,c=b.nodes[b.tank.currentIndex];return c.parentIndex>1?b.nodes[c.parentIndex].path.slice(2,-1).split("/"):m}function ob(a,b){var c=a.inst,d=c.nodes,e=d[c.tank.currentIndex],f=d[b.v];return f?e.within(f):void 0}function pb(a){for(var c,d,b=1;c=arguments[b];b++)for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);return a}function qb(){for(var c,d,e,a=0,b={};c=arguments[a];a++)for(d in c)c.hasOwnProperty(d)&&(e=c[d],b[d]=null!==e&&"object"==typeof e?qb(e):e);return b}function rb(a,b){var c,d,f,g,h,e=typeof a,i="self";if("object"===e&&s(a))for(g=a.length,f=0;g>f;f++)b=rb(a[f],b);else if("string"===e||"object"===e||"boolean"===e){if(c=qb(b),"string"===e&&a)a=a.toLowerCase(),d="!"===a.charAt(0),d&&(a=a.substr(1)),a!==i&&(c[a]=!d);else if("boolean"===e)for(h in c)h!==i&&c.hasOwnProperty(h)&&(c[h]=a);else{b={};for(h in a)a.hasOwnProperty(h)&&(b[h.toLowerCase()]=a[h]);pb(c,b,{self:!0})}return c}return b}function sb(){var a=j.pkg();a.length!==M&&(N=1===(M=a.length)?[l.attrKey]:a.map(tb).filter(ub),N=N.map(vb))}function tb(a){return j.pkg(a).attrKey}function ub(a){return a}function vb(a){var b={f:0,r:0};return"function"==typeof a?b.f=a:b.r=a,b}function wb(a,b){for(var d,c=0;d=N[c];c++)if(d.r&&d.r.test(a)||d.f&&d.f(a,b))return 0;return 1}function xb(a){var b=typeof a;return"string"===b?{_import:a}:"function"===b?{_on:a}:"object"===b?a:{}}function yb(a,b,c){for(var j,l,d=c||{},f=xb(a),g=xb(b),h=e.keys(f),i=e.keys(g),k=0;l=h[k];k++)j=g.hasOwnProperty(l),d[l]=wb(l)?j?yb(f[l],g[l],{}):f[l]:j&&"_import"!==l?g[l]:f[l];for(k=0;l=i[k];k++)f.hasOwnProperty(l)||"_import"===l||(d[l]=g[l]);return d}function zb(a,b){var c=b;return a.slice(2,-1).split("/").every(function(a){return c.hasOwnProperty(a)&&wb(a,c[a])?(c=c[a],1):void 0})?c:void 0}function Ab(a,b,c){var d,e,g,h,f=typeof a;return"string"===f?h=a:"object"===f&&a.hasOwnProperty("_import")&&(g=a._import,"object"==typeof g?(g instanceof j&&(g=l(g).nodes[1].value),e=l.prepNode(g,g)||g):h=g),h&&!c.hasOwnProperty(h)&&x.test(h)&&(e=zb(h,b)),e&&("string"===f?d=xb(e):"object"===f&&(d=yb(e,a))),d}function Bb(){var a=this,b=l(a),c=b.nodes[b.tank.currentIndex].reds[b.phase],d=c[1];c[0]?a.get.apply(a,[d].concat(b.args)):a.go(d)}var r,M,N,P,R,j=(b||a?i("Panzer"):g.Panzer).create(),k=(d.ceil(5e3*d.random())+3e3).toString(18),l=j.pkg("core"),m=[],n={},o=[],p=c.prototype.slice,q=f.prototype,s="function"==typeof c.isArray?c.isArray:function(a){return a instanceof c},t="@",u={world:!0,owner:!0,sub:!0,self:!0},v=qb(u),w=new f("[\\.\\|"+t+"]"),x=/^\/\/(?:\w+\/)+/,y=/^\/+|\/+$/g,z=/\W/,A=/\w/,B=/^\/.*\/.*\//,C={_on:0,_in:1,_out:2,_over:3,_bover:4,0:"on",1:"in",2:"out",3:"over",4:"bover"},D=[],E={"null":{f:0,i:0},program:{f:0,i:1},root:{f:function(a){return a.rootIndex}},parent:{f:function(a){return a.parentIndex}},child:{f:function(a){return a.firstChildIndex}},next:{f:function(a){return a.nextIndex}},previous:{f:function(a){return a.previousIndex}},oldest:{f:function(a,b,c){var d=b[a.parentIndex];return d?d[("y"===c.charAt(0)?"first":"last")+"ChildIndex"]:-1}},self:{f:function(a){return a.index}}},F={},G=["has","within","on","from","is"],H=G.length,I={_root:function(a,b,c,d,e,f,g){d.rootIndex=2>g||b&&c._root?g:e.rootIndex},_restrict:function(a,b,c,d,e,f,g){var h=a.substr(1);d[h]=b&&c[a]?g:e?e[h]:-1},_group:function(a,b,c,d,f){var g,h,i,j;if(f&&(d.groups=f.groups,d.cGrps=f.cGrps),b){for(h=qb(d.groups),g=c[a],s(g)||(g=[g]),i=g.length;i--;)j=g[i],"string"==typeof j&&(j=j.trim().toLowerCase())&&!u.hasOwnProperty(j)&&(h[j.toLowerCase()]=!0);d.groups=h,d.cGrps=e.keys(h)}},_perms:function(a,b,c,d,e,f){var g;b?(g=rb(c[a],e.lp),g&&(d.perms=d.lp=g)):e?(d.perms=0,d.lp=e.lp):f.perms=[d.perms=d.lp=u]},_owner:function(a,b,c,d,e,f){d.oGate=0,b?(f.ownable=d.oGate=1,d.ping=c._owner):d.ping=e?e.ping:-1},_alias:function(a,b,c,d,e,f,g){b&&c._alias&&"string"==typeof c._alias&&!w.test(c._alias)&&A.test(c._alias)?(f.tokens[c._alias]={i:g,f:0},d.alias=c._alias):d.alias=""},_capture:function(a,b,c,d,e,f){b?d.caps=Y(c._capture):e?d.caps=e.caps:(d.caps=0,f.caps=[])},_data:function(a,b,c,d){var f,e={};if(d.dcfgs=[],b){(s(c._data)?c._data:[c._data]).forEach(function(a){var c,b=typeof a;if("string"===b&&a&&(e[a]={use:0,name:a,value:h}),"object"===b&&a)for(c in a)a.hasOwnProperty(c)&&(e[c]={use:1,name:c,value:a[c]})});for(f in e)e.hasOwnProperty(f)&&d.dcfgs.push(e[f])}},_sequence:function(a,b,c,d,e){b?(d.seq=c[a]?[]:0,d.lastWalk=d.seq):(d.seq=0,d.lastWalk=e?e.lastWalk:0,d.lastWalk&&d.lastWalk.push(d.index))},_pins:function(a,b,c,d,e){d.pins=b?!!c._pins:e?e.pins:!0},_on:function(a,b,c,d){var e=c[a];b&&"function"==typeof e&&(d.fncs[C[a]]=e)},_tail:function(a,b,c,d,e,f){var g,h;b?(g=c._tail,d.tail=h={p:g},g===!0?h.n=d:g===!1?h.n=h.t=-1:"number"!=typeof g||(h.n=f.nodes[g])||(h.t=-1)):d.tail=e?e.tail:0},_conceal:function(a,b,c,d,e,f,g){d.conceal=-1,b&&g>1?c._conceal&&(d.conceal=g):e&&(d.conceal=e.conceal)}},J={_sequence:function(a,b,c,d){delete d.lastWalk},_tail:function(a,b,c,d,e,f){var h,g=d.tail;d.tail=-1,g&&(g.hasOwnProperty("n")||(g.n=f.nodes[f.indexOf(g.p,d)]),g.hasOwnProperty("t")||(h=g.n,g.t=!h||h.within(d)||h.seq&&(h===d||d.within(h))?-1:h.index),d.tail=b&&g.n===d?e.tail:g.t)},_alias:function(a,b,c,d,e,f,g){var h=d.alias;0===g?d.alias="null":1===g?d.alias="program":h&&f.tokens[h].i!==g&&(d.alias="")},_on:function(a,b,c,d,e,f,g){var i,j,k,h=-1,l=0;b&&"function"!=(j=typeof(k=c[a]))&&("string"===j&&k.length?(">"===k.charAt(0)&&(k=k.substr(1),l=1),h=f.indexOf(k,d)):"number"===j&&f.nodes[k]&&(h=k),!~h||"_on"===a&&h===g||(i=C[a],d.reds[i]=[l,h],d.fncs[i]=Bb))},_perms:function(a,b,c,d){delete d.lp}},K={0:function(a,b){a.oGate&&~a.ping&&b.pingOwner(a.ping)},1:function(a,b,c){var h,i,j,k,d=b.proxy.data,e=a.dcfgs,f=e.length,g=0;if(a.dcfgs.length)for(k=c?function(){d.hasOwnProperty(i)&&j.stack.unshift(d[i]),d[i]=h.use?h.value:j.stack[0]}:function(){j.stack.length?d[i]=j.stack.shift():(delete b.dtos[i],delete d[i])};f>g;g++)h=e[g],i=h.name,j=b.getDTO(i),k()},2:function(a,b,c){T(b.perms,a.perms,c),b.proxy.state.perms=qb(b.perms[0])},3:function(a,b,c){T(b.caps,a.caps,c)}},L=4,O=[],Q=[];j.version="0.5.0",I._ingress=I._restrict,I._in=I._out=I._over=I._bover=I._on,J._in=J._out=J._over=J._bover=J._on;for(r in I)I.hasOwnProperty(r)&&(O[O.length]=r);P=O.length;for(r in J)J.hasOwnProperty(r)&&(Q[Q.length]=r);return R=Q.length,E["."]=E.self,E[".."]=E.parent,E.youngest=E.oldest,Y(!0),pb(l,{actives:[],attrKey:/^_/,badKey:/^\d|^\W|[^a-zA-Z\d\-_\+=\(\)\*\&\^\%\$\#\!\~\`\{\}\"\'\:\;\?\, ]+|^toString$/,prepTree:function(a){return sb(),S(a)?l(a).nodes[1].value:void 0},prepNode:function(a,b){for(var c,d=a;d=Ab(d,b,{});)c=d;return c},init:function(){var g,h,i,j,k,l,a=this,b=D[0],c={},d={name:"_null",path:"..//",depth:0,index:0,pins:!0,alias:"null",perms:v,groups:o},e=a.nodes,f=e.length;for(a.bin={},a.tin={},a.groups=n,a.nStr=a.pStr=a.lastPing="|",a.sAry=[],a.pAry=[],a.vars={},a.tokens={},a.cq={},a.args=[],a.calls=[],a.trail=[],a.tgtTrail=-1,a.dtos={},a.waitTimer=a.waitFnc=a.waitArgs=0,a.cache={indexOf:{},store:{}},a.active=0,a.blessed=0,a.nids={},a.pinned=0,a.pinning=[],a.targets=[],a.phase=0,a.owner=a.ownable=0,a.nodes[0].name="_null",a.nodes[1].name="_program",g=0;f>g;g++){for(i=e[g],j=e[i.parentIndex],a.nids[i.path]=g,g>1&&(a.nStr+=i.name+"|",a.sAry[a.sAry.length]=i.name),a.pStr+=i.path+"|",a.pAry[a.pAry.length]=i.path,i.pkg=a,i.fncs=[0,0,0,0,0],i.reds=[],h=0;P>h;h++)k=O[h],I[k](k,i.attrs.hasOwnProperty(k),i.attrs,i,j,a,g);i.fncs[0]||"function"!=typeof i.value||(i.fncs[0]=i.value)}for(g=0;f>g;g++)for(i=e[g],h=0;R>h;h++)k=Q[h],J[k](k,i.attrs.hasOwnProperty(k),i.attrs,i,j,a,g);for(l in a.pkgs)a.pkgs.hasOwnProperty(l)&&(a.pkgs[l].proxy.data=c,a.pkgs[l].proxy.state=d);b&&(a.ownable&&(a.owner=b),b.caps[0]&&V(b.tin,[a],b))},onBegin:function(){var a=this;D.unshift(a),l.actives.unshift(a.proxy),a.active=1,a.preMove(),a.pinned&&a.tank.stop()},onNode:function(a,b){var c=this,d=c.proxy.state,e=c.nodes[b];d.name=e.name,d.index=e.index,d.depth=e.depth,d.path=e.path,d.pins=e.pins,d.alias=e.alias,d.groups=e.cGrps.concat(),c.groups=e.groups},onScope:function(a,b){var c=this,d=c.nodes[c.tank.currentIndex];c.phase=b?1:2,d.scope(b)},onEngage:function(){var a=this;a.setPrivs()},onRelease:function(){var a=this;a.delPrivs()},onTraverse:function(a,b){var c=this,d=c.tank,e=c.nodes[d.currentIndex];c.phase=b,~d.targetIndex||(c.tgtTrail=c.targets.shift()),e.seq&&!b&&c.proxy.go.apply(c.proxy,e.seq),e.fncs[b]&&(c.calls.push(e.index+"."+b),c.result=e.fncs[b].apply(c.proxy,c.targets.length?[]:c.args),(c.paused||c.pinned)&&(c.result=h))},onTraversing:function(){var a=this;a.waitFnc&&(a.waitFnc.apply(a.proxy,a.waitArgs),a.waitFnc=a.waitArgs=0)},onTraversed:function(){var a=this,b=a.proxy,c=a.nodes[a.tank.currentIndex];c.caps&&V(a.bin,X(a.tin,c.caps),a),a.tin={},!a.phase&&~a.tgtTrail&&(a.trail[a.trail.length]=a.tgtTrail,a.tgtTrail=-1),b.args!==a.args&&s(b.args)&&(a.args=b.args),"object"==typeof b.vars&&(a.vars=b.vars),b.vars=a.vars},onEnd:function(){var d,a=this,b=a.tank,c=D[1],e=a.pause||a.pinned||a.phase,f=a.targets.length,g=a.nodes[b.currentIndex];if(e||!f&&!~g.tail){if(e)c&&c.nodes[(d=c.tank).currentIndex].pins&&g.pins&&!a.pinning[d.id]&&!c.pinning[b.id]&&(c.pinned++,a.pinning[d.id]=c,d.stop());else{if(~g.ping){if(a.pingOwner(g.ping),a.paused||a.pinned||a.targets.length)return;a.lastPing=""}a.args=[],a.calls=[],a.trail=[],g.index||(a.vars={}),a.pinning.length&&(a.pinning.forEach(function(a){a.pinned--}),b.post(function(){a.pinning.splice(0).forEach(function(a){a.pinned||a.pause||a.go()})}))}D.shift(),l.actives.shift(),a.active=0}else f?b.go(a.targets[0]):a.proxy.go(g.tail)}}),pb(l.prototype,{indexOf:function(a,b){var f,g,h,i,j,k,l,m,n,o,p,q,c=this,d=c.nodes,e=c.nids,r=-1;switch(b=f=b||c.nodes[c.tank.currentIndex],typeof a){case"object":null!==a&&(a=a.index);case"number":d[a]&&(r=a);break;case"function":a+="";case"string":if("..//"===a||"//"===a){r="//"===a?1:0;break}if(g=!w.test(a),"/"!==a.slice(-1)&&(a+="/"),"/"===a.charAt(0)){if("/"===a.charAt(1)){if(g){r=e[a]||-1;break}f=d[0]}else if(f=d[f.rootIndex],g){r=e[f.path+a.substr(1)]||-1;break}}else if(g){r=e[f.path+a]||-1;break}if(a=a.replace(y,""),i=a+b.index,!c.cache.indexOf.hasOwnProperty(i)){j=a.split("/"),l=j.length;a:for(k=0;l>k;k++){for(m=j[k].split("|"),o=m.length,n=0;o>n;n++){if(h=m[n],p=-1,!h)break a;if(z.test(h)?(h.charAt(0)===t&&(h=h.slice(1)),q=E[h]||c.tokens[h],q&&(p=q.f?q.f(f,d,h):q.i)):p=e[f.path+h+"/"]||-1,~p){f=d[p];break}}if(!~p)break}c.cache.indexOf[i]=r=p}r=c.cache.indexOf[i]}return r},vetIndexOf:function(a,b){var c=this,d=c.indexOf(a,b);return~d?(b||(b=c.nodes[c.tank.currentIndex]),b.canTgt(c.nodes[d])?d:-1):-1},getDTO:function(a){var b=this;return b.dtos.hasOwnProperty(a)||(b.dtos[a]={name:a,stack:[]},"object"==typeof b.proxy.data&&b.proxy.data.hasOwnProperty(a)&&(b.dtos[a].stack[0]=b.proxy.data[a])),b.dtos[a]},go:function(){var a=this;return a.preMove(),a.tank.go(a.targets[0])},preMove:function(){var a=this;clearTimeout(a.waitTimer),a.pause=0},is:function(){var b,g,a=this,c=a.perms[0],d=D[0],e=d&&a!==d,f=arguments.length;if(e)for(g in c)if(c.hasOwnProperty(g)&&!u.hasOwnProperty(g)&&d.groups.hasOwnProperty(g))return c[g];for(;f--;)switch(arguments[f]){case"self":if(a===d||a.blessed)return 1;break;case"owner":if(c.owner&&a.owner===d)return 1;break;case"sub":if(c.sub&&e&&(a.bin.hasOwnProperty(b=d.tank.id)||a.tin.hasOwnProperty(b)))return 1;break;case"world":if(c.world&&(!d||!a.is("sub","owner","self")))return 1}return 0},pingOwner:function(a){var e,b=this,c=b.proxy,d=b.owner;d&&(e=""+b.tank.currentIndex+b.phase+d.tank.id+a,e!==b.lastPing&&(b.lastPing=e,d.proxy.get(a,c,c.status(),qb(c.state))))},setPrivs:function(){var a=this,b=a.proxy;b.hasOwnProperty("vars")&&(a.tvars=b.vars),b.hasOwnProperty("args")&&(a.targs=b.args),b.vars=a.vars,b.args=a.args},delPrivs:function(){var a=this,b=a.proxy;b.vars!==a.vars&&"object"==typeof b.vars&&(a.vars=b.vars),b.args!==a.args&&s(b.args)&&(a.args=b.args),a.hasOwnProperty("tvars")?(b.vars=a.tvars,delete a.tvars):delete b.vars,a.hasOwnProperty("targs")?(b.args=a.targs,delete a.targs):delete b.args}}),pb(l.node,{groups:{},cGrps:o,scope:function(a){for(var b=this,c=b.pkg,d=L;d--;)K[d](b,c,a)},canTgt:function(a){var b=this,c=b.pkg,d=b.pkg.nodes[this.restrict],e=b.pkg.nodes[a.ingress];return c.is("self")||c.is("sub","owner","world")&&(!d||a.within(d))&&(!e||b===e||a===e||this.within(e))&&!~a.conceal},within:function(a){var b=arguments.length?"object"==typeof a?a:this.pkg.nodes[a]:this.pkg.nodes[this.pkg.tank.currentIndex];return b?!(b===this||b.index&&this.path.indexOf(b.path)):!1}}),pb(l.proxy,{callbacks:function(a,b,c){var e,f,d=l(this);return a===!0&&(a=d.tank.currentIndex),b=+!!b,c=+!!c&&d.is("self"),f=""+a+b+c,d.cq.hasOwnProperty(f)?d.cq[f]:(e=function(){var e,f;return c&&!d.blessed&&(f=1,d.blessed=1),e=b?d.proxy.go(a):d.proxy.get.apply(d.proxy,[a].concat(p.call(arguments))),f&&(d.blessed=0),e},d.cq[f]=e)},query:function(){var c,e,a=l(this),b=[],d=arguments.length;if(d){for(;d--;){if(c=arguments[d],e=a.vetIndexOf(c),!~e)return!1;b.push(a.nodes[e].path)}return 1===b.length?b[0]:b.reverse()}return!1},perms:function(a){var b=this,c=l(b),d=arguments.length;return c.is("sub","owner","self")?(d&&(d>1&&(a=p.call(arguments)),b.state.perms=qb(c.perms[0]=rb(a,c.perms[0]))),!0):!1},get:function(a){var b=this,c=l(b),d=c.is("world","sub","owner","self")?c.vetIndexOf(a):-1;return~d?(c.args=b.args=p.call(arguments).slice(1),c.targets=[d],c.go(),c.pinned||c.pause||c.phase?!1:c.active||c.result===h?!0:c.result):!1},go:function(){var a=l(this),b=a.pause,c=[],d=0;if(a.is("world","sub","owner","self")&&p.call(arguments).every(function(b){var d=a.vetIndexOf(b);return c.push(d),~d})){if(c.length){for(;c[c.length-1]===a.targets[0];)c.pop();a.targets=c.concat(a.targets)}d=a.go()||b}return!!d},wait:function(){var g,i,j,a=this,b=l(a),c=arguments,d=c.length,e=d>2,f=2>d;return b.is("sub","owner","self")&&(d&&(f?j=c[0]:(j=c[1],g=c[0],"function"!=typeof g&&(i=b.indexOf(g),~i&&(g=function(){e?a.get.apply(a,[i].concat(p.call(c,2))):a.get.call(a,i)})))),!d||"number"==typeof j&&(f||"function"==typeof g))?(b.pause=1,b.tank.stop(),clearTimeout(b.waitTimer),d&&(b.waitTimer=setTimeout(function(){"function"==typeof g&&(b.waitFnc=g,b.waitArgs=e&&i===h?p.call(c,2):[]),b.go()},~~j)),!0):!1},owner:function(a){var b=arguments.length,c=l(this),d=c.is("owner","self"),e=d||!c.owner;if(b){if(e){if(S(a)&&a!==c.proxy)return c.owner=l(a),a;if(a===!1)return c.owner=0,!0}return!1}return d?c.owner.proxy:!!c.owner},subs:function(a){var h,i,j,b=l(this),c=p.call(arguments),d=c.length,e=b.is("sub","owner","self"),f=b.tin,g=b.bin;if(d>1&&"remove"===a){if(!e)return 0;if(c.shift(),S(c[0])){for(j=c.length;j--;)if(!(c[j]=l(c[j])))return 0;return W(g,c)+W(f,c)}return d>1?(h=2===d&&null===c[0]&&b.caps[0]?b.caps[0]:Y(c[0]),~h.buffer?h.buffer?W(f,X(f,h)):W(g,X(g,h)):W(f,X(f,h))+W(g,X(g,h))):0}if(S(a)){if(!e)return 0;for(j=d;j--;)if(!(c[j]=l(c[j])))return 0;return W(f,c),V(g,c,b)}if(h=null===a&&b.caps[0]?b.caps[0]:d?Y(a):F.ctrue,i=~h.buffer?h.buffer?X(f,h):X(g,h):X(f,h).concat(X(g,h)),j=i.length,e){for(;j--;)i[j]=i[j].proxy;return i}return j},status:function(a){function g(a){return b.nodes[a].path}var b=l(this),c={},e=!arguments.length;return(e||"active"===a)&&(c.active=!!b.active),(e||"loops"===a)&&(c.loops=d.max((b.calls.join().match(new f("\\b"+b.tank.currentIndex+"."+b.phase,"g"))||[]).length-1,0)),(e||"paused"===a)&&(c.paused=!!b.pause),(e||"phase"===a)&&(c.phase=b.active?C[b.phase]:""),(e||"pinned"===a)&&(c.pinned=!!b.pinned),(e||"targets"===a)&&(c.targets=b.targets.map(g)),(e||"trail"===a)&&(c.trail=b.trail.map(g)),e?c:c[a]}}),j}a?define(i):b?module.exports=i(require):g.Salt||(g.Salt=i())}("function"==typeof define,"undefined"!=typeof exports,Array,Math,Object,RegExp,this);