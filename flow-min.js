/*
 * Flow (NextGen) v0.X
 * http://github.com/bemson/Flow/tree/nextGen
 *
 * genData v0.6
 * http://github.com/bemson/genData/
 *
 * Copyright 2011, Bemi Faison
 * Both released under the MIT License
 */
!function(){function i(c){function j(){function a(){this.pkgs=d,this.toString=i}a.prototype=new e;return a}function i(b){return b===a?g:Object.prototype.toString.apply(this,arguments)}var d={},f=new(j()),g=new h(c,f);b.forEach(function(a){var b=j();b.prototype=new a.model,d[a.name]=new b});return f}function h(a,c){var d=this;d.states=g(a),d.shared={currentIndex:0,targetIndex:0,go:function(a){d.target=d.states[a],d.shared.targetIndex=a;return d.go()},stop:function(){d.stop=1;return!0}},d.current=d.states[0],d.target=d.looping=0,d.pkgs=b.map(function(a){function e(){}var b={name:a.name};e.prototype=new a.pkg,b.pkg=new e,b.pkg.states=d.states.map(function(a){function b(){}b.prototype=a;return new b}),a.pkg.init&&a.pkg.init.call(b.pkg),a.pkg.flow=d.shared,a.pkg.proxy=c;return b})}function g(a){var b=d(a);b[0].parentIndex=b[0].childIndex=0,b.unshift(d()[0]),b[0].children.push(1),b[0].name="_flow",b[0].index=0,b[0].depth=0,b[0].location="..//",b[0].firstChildIndex=b[0].lastChildIndex=1;return b}function f(d){function g(){}function f(b){var c=b&&b.toString(a);return typeof c=="object"&&(c.pkgs.filter(function(a){return a.name===d})[0]||{}).pkg}f.init=f.dataKey=f.invalidKey=f.onStart=f.onEnd=f.onFinish=f.onTraverse=0,g.prototype=new e,e=g,f.api=g.prototype,c[d]=b.push({name:d,pkg:f,model:g})-1;return f}function e(){}var a={},b=[],c={},d=new genData(function(a,c,d,e,f){var g=this,h=a&&!b.every(function(b){return!b.pkg.invalidKey||!b.pkg.invalidKey.test(a)}),i=a&&!b.every(function(b){return!b.pkg.dataKey||!b.pkg.dataKey.test(a)});h||i?(f.exclude=1,f.scanValue=0,i&&!h&&(d.data[a]=c)):(g.inContext=g.parentIndex=g.previousIndex=g.nextIndex=g.firstChildIndex=undefined,g.index=e.length+1,g.depth=d?d.depth+1:1,g.name=d?a:"_root",g.data={},g.location=d?d.location+a+"/":"//",g.children=[],delete g.parent,d&&(g.parentIndex=d.index,d.children.length||(d.firstChildIndex=g.index),g.childIndex=d.children.push(g.index)-1,d.lastChildIndex=g.index,g.childIndex&&(g.previousIndex=d.children[g.childIndex-1],e[g.previousIndex-1].next=g.index)))});d.prototype.getStep=function(a){var b=this,c=a.index-b.index;if(c<0)return[b.inContext?2:4,b.previousIndex||b.parentIndex];if(c>0)return b.nextIndex<a.index?[b.inContext?2:3,b.nextIndex]:[1,b.firstChildIndex];return[b.inContext?0:1,b.index]},h.prototype={go:function(){var a=this,b=a.states,c=a.shared,d;if(a.looping)return!!a.target;a.stop=0,a.looping=1,a.fire("Start"),a.goCheck();while(a.canGo()){d=a.current.getStep(a.target),a.fire("Traverse",[d[0]]);switch(d[0]){case 0:a.target=0,c.targetIndex=-1;break;case 1:case 2:a.current.inContext=(d[0]-2)*-1}a.goCheck(),a.target&&d[1]===a.current.getStep(a.target)[1]&&(a.current=b[d[1]],c.currentIndex=d[1])}a.looping=0;return a.current.index},canGo:function(){return!this.stop&&this.target},goCheck:function(){this.canGo()||(this.fire("Stop"),this.target||this.fire("Finish"))},fire:function(a,d){a="on"+a,d=d||[],this.pkgs.forEach(function(e){var f=b[c[e.name]].pkg[a];f&&f.apply(e.pkg,d)})}},i.pkg=function(a){if(arguments.length){if(typeof a=="string"&&/\w/.test(a)){c.hasOwnProperty(a)||f(a);return b[c[a]].pkg}return!1}return b.map(function(a){return a.name})},window.Flow=i}()