/* Flow v1.0.0 + genData v1.2.0 | github.com/bemson | (c) 2011, MIT */
function genData(a){var b=arguments,c=b.callee,d,e,f,g,h=[],i=[],j,k={},l,m,n,o=c,p=typeof o=="function",q;if(this instanceof c){if(a){~{}.toString.call(b[1]).indexOf("y")&&(o=a,b=b[1]),h=h.concat([].slice.call(b));function s(a,b,d){var e=~{}.toString.call(b).indexOf("y");return this instanceof s?a?new c(e?a:s,h.concat(e?b:[].slice.call(arguments))):this:c(a,h.concat(b||[]),d?d:s)}return s.prototype=p?new o:o,s}return this}b[1]&&(h=typeof b[1]=="function"?[b[1]]:b[1]),f=h.length,b[2]&&(o=b[2]);function r(a,b){this.name=a,this.value=b}r.prototype=p?o.prototype:o,l=[["",a]];while(l.length){n=l.shift(),q=new r(n[0],n[1]),e=0,d={parent:0,omit:0,scan:1,exit:0},b=[q.name,q.value,n[2],i,d,k];while(e<f&&!d.exit)h[e++].apply(q,b);d.omit?q._OMIT=!0:i.push(q);if(d.exit)l=[];else{m=[];if(d.scan&&typeof q.value=="object"){j=typeof d.parent=="object"?d.parent:q;for(g in q.value)q.value.hasOwnProperty(g)&&m.push([g,q.value[g],j])}l=m.concat(l)}}return i};
!function(inCommonJsEnv,Array,Object,window,undefined){function ProxyModel(){}function pkgModel(){}function definePackage(a){function c(a){var c=a&&a.toString(secretObject);return c instanceof Flow&&(c.pkgs[b]||{}).pkg||!1}function d(){}function e(){}var b=pkgDefs.length;return c.prototype=new pkgModel,c.init=c.attributeKey=c.invalidKey=c.onBegin=c.onEnd=c.onTraverse=0,d.prototype=new ProxyModel,ProxyModel=d,c.proxy=d.prototype,c.state=e.prototype,pkgsIdx[a]=pkgDefs.push({name:a,pkg:c,model:d,state:e})-1,c}function createProgramStates(program){var states=genStates(program);states[0].parentIndex=states[0].childIndex=0,states.unshift(genStates()[0]);with(states[0])children.push(1),name="_flow",index=0,depth=0,path="..//";return states[0].firstChildIndex=states[0].lastChildIndex=1,states}function Flow(a,b,c){var d=this;d.prgm=a,d.states=createProgramStates(a),d.tank={id:++flowCnt,currentIndex:0,targetIndex:-1,stop:function(){return d.stop=1,d.loop},post:function(a){switch(typeof a){case"function":return d.posts.push(a)-1;case"number":if(d.posts[a])return d.posts[a]=0,!0}return!1}},d.posts=[],d.current=d.states[0],d.target=d.loop=0,d.pkgs=pkgDefs.map(function(a){function f(){}var e={name:a.name};return f.prototype=new a.pkg,e.pkg=new f,e.pkg.states=genCloneStates(d.states,0,a.state),e.pkg.tank=d.tank,e.pkg.proxy=b,typeof a.pkg.init=="function"&&a.pkg.init.call(e.pkg,c),e}),d.tank.go=function(a){var b=d.states[a];return b&&(d.target=b,d.tank.targetIndex=b.index),d.stop=0,d.go()}}function FlowAPI(a,b){function f(a){return a===secretObject?e:Object.prototype.toString.apply(this,arguments)}function g(){function a(){this.pkgs=c,this.toString=f}return a.prototype=new ProxyModel,a}if(this instanceof arguments.callee){var c={},d=new(g()),e=new Flow(a instanceof ProxyModel?a.toString(secretObject).prgm:a instanceof pkgModel?a.proxy.toString(secretObject).prgm:a,d,b instanceof Object?b:{});return pkgDefs.forEach(function(a){var b=g();b.prototype=new a.model,c[a.name]=new b}),d}throw new Error('Missing "new" operator.')}if(!inCommonJsEnv&&window.Flow)return;var environment=inCommonJsEnv?exports:window,genData=(inCommonJsEnv?require("genData"):window).genData,flowCnt=0,secretObject={},pkgDefs=[],pkgsIdx={},testStateKey=function(a,b,c){return b.length&&pkgDefs.some(function(d){var e=d.pkg[a];switch(typeof e){case"function":return e(b,c);case"object":if(e instanceof RegExp)return e.test(b)}})},genStates=new genData(function(a,b,c,d,e){var f=this,g=testStateKey("invalidKey",a,b),h=testStateKey("attributeKey",a,b);g||h?(e.omit=1,e.scan=0,h&&!g&&(c.attributes[a]=b)):(f.inContext=f.parentIndex=f.previousIndex=f.nextIndex=f.firstChildIndex=undefined,f.index=d.length+1,f.depth=c?c.depth+1:1,f.name=c?a:"_root",f.attributes={},f.path=c?c.path+a+"/":"//",f.children=[],c&&(f.parentIndex=c.index,c.children.length||(c.firstChildIndex=f.index),f.childIndex=c.children.push(f.index)-1,c.lastChildIndex=f.index,f.childIndex&&(f.previousIndex=c.children[f.childIndex-1],d[f.previousIndex-1].nextIndex=f.index)))}),genCloneStates=new genData(function(a,b,c,d,e){if(!c)e.omit=1;else{e.scan=0;for(var f in b)b.hasOwnProperty(f)&&(this[f]=b[f])}}),arrayPrototype=Array.prototype;arrayPrototype.some||(arrayPrototype.some=function(a,b){for(var c=0,d=this.length;c<d;c++)if(a.call(b,this[c],c,this))return!0;return!1}),arrayPrototype.filter||(arrayPrototype.filter=function(a,b){var c=[],d=0,e=this.length,f;for(;d<e;d++)f=this[d],a.call(b,f,d,this)&&c.push(f);return c}),arrayPrototype.forEach||(arrayPrototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)}),arrayPrototype.map||(arrayPrototype.map=function(a,b){var c=0,d=this.length,e=new Array(d);for(;c<d;c++)e[c]=a.call(b,this[c],c,this);return e}),ProxyModel.prototype.constructor=FlowAPI,Flow.prototype={go:function(){var a=this,b=a.states,c=a.tank,d,e=0,f=a.current,g=0,h=0,i;if(a.loop)return!!a.target;a.posts=[],a.loop=1,a.fire("Begin");while(a.loop)a.target&&!a.stop?(i=0,d=a.target.index-f.index,d?d>0&&f.index<2||!a.target.path.indexOf(f.path)?f.inContext?(g=0,h=f.firstChildIndex):(g=1,h=1,f.inContext=1):f.inContext?(g=1,h=2,f.inContext=0):(a.target.path.indexOf(b[f.parentIndex].path)&&(d=-1),h=d<0?4:3,f.lastEvent===2||f.lastEvent===h||f.lastEvent+h===7?(g=0,h=d>0?f.nextIndex:f.previousIndex||f.parentIndex):g=1):(g=1,h=f.inContext?0:1,f.inContext&&(a.target=0,c.targetIndex=-1),f.inContext=1),g?(f.lastEvent=h,e++,a.fire("Traverse",[h])):(f.lastEvent=0,f=a.current=b[h],c.currentIndex=h)):!i&&(a.stop||!a.target)?(i=1,a.fire("End")):a.loop=0;return a.posts.forEach(function(a){typeof a=="function"&&a()}),e},fire:function(a,b){b=b||[],b.unshift(a.toLowerCase()),a="on"+a,this.pkgs.forEach(function(c){var d=pkgDefs[pkgsIdx[c.name]].pkg[a];typeof d=="function"&&d.apply(c.pkg,b)})}},FlowAPI.pkg=function(a){return arguments.length?typeof a=="string"&&/\w/.test(a)?(pkgsIdx.hasOwnProperty(a)||definePackage(a),pkgDefs[pkgsIdx[a]].pkg):!1:pkgDefs.map(function(a){return a.name})},environment.Flow=FlowAPI}(typeof require!="undefined",Array,Object,this);