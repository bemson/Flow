/*
Flow v0.X / Bemi Faison (c) 2011 / MIT
http://github.com/bemson/Flow/tree/nextGen

genData v0.8.1 / Bemi Faison (c) 2011 / MIT
http://github.com/bemson/genData/
*/
function genData(a){var b=arguments,c,b,d=b.callee,e,f,g,h=[],i=[],j,k,l,m=d,n;if(!(this.hasOwnProperty&&this instanceof d)){b[1]&&(h=typeof b[1]=="function"?[b[1]]:b[1]),f=h.length;function o(a,b){this.name=a,this.value=b}b[2]&&(m=b[2]),o.prototype=m.prototype,o.prototype.constructor=m,k=[["",a]];while(k.length){l=k.shift(),e=0,n=new o(l[0],l[1]),c={omit:0,scan:1,exit:0},b=[n.name,n.value,l[2],i,c];while(e<f&&!c.exit)h[e++].apply(n,b);c.omit?n._OMIT=!0:i.push(n);if(c.exit)k=[];else{j=[];if(c.scan&&typeof n.value=="object")for(g in n.value)n.value.hasOwnProperty(g)&&j.push([g,n.value[g],n]);k=j.concat(k)}}return i}if(a!==d){b[1]instanceof Array&&(m=a,b=b[1]),h=h.concat([].slice.call(b));function p(a,b,c){if(!(this.hasOwnProperty&&this instanceof p))return d(a,h.concat(b||[]),c&&c.protoype?c:p);if(a!==d)return new d(p,h.concat([].slice.call(arguments)));return this}p.prototype=new m(d),p.prototype.constructor=p;return p}return this}
!function(a,b){function k(a){function i(){function a(){this.pkgs=b,this.toString=h}a.prototype=new g;return a}function h(a){return a===c?f:Object.prototype.toString.apply(this,arguments)}var b={},e=new(i()),f=new j(a,e);d.forEach(function(a){var c=i();c.prototype=new a.model,b[a.name]=new c});return e}function j(a,b){var c=this;c.states=i(a),c.shared={currentIndex:0,targetIndex:0,go:function(a){c.target=c.states[a],c.shared.targetIndex=a,c.stop=0;return c.go()},stop:function(){c.stop=1;return!0}},c.current=c.states[0],c.target=c.looping=0,c.pkgs=d.map(function(a){function e(){}var d={name:a.name};e.prototype=new a.pkg,d.pkg=new e,d.pkg.states=c.states.map(function(a){function b(){}b.prototype=a;return new b}),a.pkg.init&&a.pkg.init.call(d.pkg),d.pkg.flow=c.shared,d.pkg.proxy=b;return d})}function i(a){var b=f(a);b[0].parentIndex=b[0].childIndex=0,b.unshift(f()[0]),b[0].children.push(1),b[0].name="_flow",b[0].index=0,b[0].depth=0,b[0].location="..//",b[0].firstChildIndex=b[0].lastChildIndex=1;return b}function h(a){function f(){}function b(b){var d=b&&b.toString(c);return typeof d=="object"&&(d.pkgs.filter(function(b){return b.name===a})[0]||{}).pkg}b.init=b.dataKey=b.invalidKey=b.onStart=b.onEnd=b.onFinish=b.onTraverse=0,f.prototype=new g,g=f,b.api=f.prototype,e[a]=d.push({name:a,pkg:b,model:f})-1;return b}function g(){}var c={},d=[],e={},f=new genData(function(a,c,e,f,g){var h=this,i=a&&!d.every(function(b){var d=b.pkg.invalidKey;return!d||(typeof d=="function"?!d(a,c):!d.test(a))}),j=a&&!d.every(function(b){var d=b.pkg.dataKey;return!d||(typeof d=="function"?!d(a,c):!d.test(a))});i||j?(g.omit=1,g.scan=0,j&&!i&&(e.data[a]=c)):(h.inContext=h.parentIndex=h.previousIndex=h.nextIndex=h.firstChildIndex=b,h.index=f.length+1,h.depth=e?e.depth+1:1,h.name=e?a:"_root",h.data={},h.location=e?e.location+a+"/":"//",h.children=[],e&&(h.parentIndex=e.index,e.children.length||(e.firstChildIndex=h.index),h.childIndex=e.children.push(h.index)-1,e.lastChildIndex=h.index,h.childIndex&&(h.previousIndex=e.children[h.childIndex-1],f[h.previousIndex-1].nextIndex=h.index)))});j.prototype={go:function(){var a=this,b=a.states,c=a.shared,d,e=a.current,f=0,g=0,h,i;if(a.looping)return!!a.target;a.looping=1,a.fire("Start");while(a.looping)a.target&&!a.stop?(h=i=0,d=a.target.index-e.index,d?d>0&&e.index<2||!a.target.location.indexOf(e.location)?e.inContext?(f=0,g=e.firstChildIndex):(f=1,g=1,e.inContext=1):e.inContext?(f=1,g=2,e.inContext=0):(a.target.location.indexOf(b[e.parentIndex].location)&&(d=-1),g=d<0?4:3,e.lastEvent===2||e.lastEvent===g?(f=0,g=d>0?e.nextIndex:e.previousIndex||e.parentIndex):f=1):(f=1,g=e.inContext?0:1,e.inContext&&(a.target=0,c.targetIndex=-1),e.inContext=1),f?(e.lastEvent=g,a.fire("Traverse",[g])):(e.lastEvent=0,e=a.current=b[g],c.currentIndex=g)):!h&&(a.stop||!a.target)?(h=1,i=0,a.fire("Stop")):h&&!i&&!a.target?(i=1,a.fire("Finish")):a.looping=0;return e.index},fire:function(a,b){a="on"+a,b=b||[],this.pkgs.forEach(function(c){var f=d[e[c.name]].pkg[a];f&&f.apply(c.pkg,b)})}},k.pkg=function(a){if(arguments.length){if(typeof a=="string"&&/\w/.test(a)){e.hasOwnProperty(a)||h(a);return d[e[a]].pkg}return!1}return d.map(function(a){return a.name})},a.Flow=k}(this)