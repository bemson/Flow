/* Flow v0.5.0 + Panzer v0.3.10 + genData v3.1.0 | github.com/bemson | (c) 2013, MIT */
;!function(a,b,c){function f(a){return"function"==typeof a}function g(a){return"function"!=typeof a}function h(a){function w(a,b){this.name=a,this.value=b}if(this instanceof h)return this;var e,i,l,m,o,p,q,r,s,t,b=[["",a]],j=d.call(arguments),k=j.slice(1),n=k.filter(f),u=[],v=n.length;if(!v)return[];for(w.prototype=("function"==typeof this?this:h).prototype,l={returns:u,args:k.filter(g),params:j,loop:0,queued:0};b.length;){for(i=b.shift(),q=new w(i[0],i[1]),r=t=0,p=[i[0],i[1],i[2],l],l.continues=0,l.breaks=0,l.source=i[1];!l.continues&&v>r;)l.allowUndefined=0,o=n[r++].apply(q,p),(o!==c||l.allowUndefined)&&(m=o,t=1);if(t&&u.push(m),l.breaks)break;if("object"==typeof l.source){e=[];for(s in l.source)l.source.hasOwnProperty(s)&&e.push([s,l.source[s],q]);b=e.concat(b)}l.loop++,l.queued=b.length-1}return l.hasOwnProperty("returns")?l.returns:u}var d=a.prototype.slice;a.isArray||function(b){return b instanceof a},h.spawn=function i(){function c(e){return this instanceof c?this:a.apply("function"==typeof this?this:c,[e].concat(b,d.call(arguments).slice(1)))}var a=this,b=d.call(arguments).filter(f);return c.prototype=new a,c.spawn=i,c},h.version="3.1.0",b.genData=h}(Array,this);
!function(c,g,e,b,a,d,h){function f(k){var r={create:function(){var v={pkgs:[],pkgsIdx:{},KlassProxy:function(){},Klass:w};function w(y,x){if(!(this instanceof w)){throw new Error("Missing new operator.")}new m(v,this,y,typeof x==="object"?x:{})}w.prototype=v.KlassProxy.prototype;w.pkg=function(){return u.apply(v,arguments)};return w},version:"0.3.10"},s=(g||c)?k("genData"):d.genData,n=0,l=0,i=({}).toString(),o=s.spawn(function(x,H,I,A){var B=this,E=A.args[0],C=A.args[1],y=A.returns,w=C&&x&&(C.nf.some(z)||C.nr.some(F)),G=C&&x&&(C.af.some(z)||C.ar.some(F)),J,D,v=0;function z(K){return K.call(d,x,H)}function F(K){return K.test(x)}if(w||G){A.source=0;if(G){I.attrs[x]=H}}else{B.parentIndex=B.previousIndex=B.nextIndex=B.firstChildIndex=B.lastChildIndex=B.childIndex=B.ctx=B.lte=-1;B.index=y.push(B);B.depth=I?I.depth+1:1;B.name=x||"PROOT";B.attrs={};B.path=I?I.path+x+"/":"//";B.children=[];if(I){B.parentIndex=I.index;if(!I.children.length){I.firstChildIndex=B.index}B.childIndex=I.children.push(B.index)-1;I.lastChildIndex=B.index;if(B.childIndex){B.previousIndex=I.children[B.childIndex-1];y[B.previousIndex-1].nextIndex=B.index}}else{A.tree=H}if(I&&E&&E.pkgs.length){for(;D=E.pkgs[v];v++){if(typeof D.def.prepNode==="function"&&typeof(J=D.def.prepNode.call(d,A.source,A.tree))!=="undefined"){A.source=J}}}}}),t=s.spawn(function(w,z,x,v){var y=this,A;if(x){v.source=0;for(A in z){if(z.hasOwnProperty(A)&&A!=="lte"&&A!=="ctx"){y[A]=z[A]}}return y}}),q=/\w/;function m(D,x,w,z){var H=this,E={},C={},y={af:[],ar:[],nf:[],nr:[]},F,G,A,B;function v(I,J){if(I===D&&J<H.pkgs.length){return H.pkgs[J].inst}return i}for(F=0;A=D.pkgs[F];F++){if(typeof A.def.attrKey==="function"){y.af.push(A.def.attrKey)}else{if(A.def.attrKey instanceof a){y.ar.push(A.def.attrKey)}}if(typeof A.def.badKey==="function"){y.nf.push(A.def.badKey)}else{if(A.def.badKey instanceof a){y.nr.push(A.def.badKey)}}if(typeof A.def.prepTree==="function"&&typeof(B=A.def.prepTree.call(d,w))!=="undefined"){w=B}}H.nodes=o(w,D,y);H.nodes[0].parentIndex=H.nodes[0].childIndex=0;H.nodes.unshift(o()[0]);H.nodes[0].children.push(1);H.nodes[0].name="PNULL";H.nodes[0].index=H.nodes[0].depth=H.nodes[0].lte=0;H.nodes[0].path="..//";H.nodes[0].firstChildIndex=H.nodes[0].lastChildIndex=1;H.nodes[0].ctx=1;H.tank={id:n++,currentIndex:0,targetIndex:-1,go:function(I){var J=H.nodes[I];if(J){H.target=J;H.tank.targetIndex=J.index}H.stop=0;return H.go()},stop:function(){H.stop=1;return !!H.loop},post:function(I){var J=typeof I;if(H.loop){if(J==="function"){H.posts[++l]=I;return l}else{if(J==="number"){if(H.posts.hasOwnProperty(I)){delete H.posts[I];return true}}}}return false}};H.posts={};H.current=H.nodes[0];H.target=H.loop=0;H.pkgs=D.pkgs.map(function(I){var K=I.name,M=I.def,L={name:K,idx:I.idx,pkg:I,inst:new M()};function J(){}J.prototype=I.proxy.prototype;E[K]=L.proxy=new J();C[K]=L.inst;L.proxy.pkgs=E;L.proxy.toString=v;L.inst.pkgs=C;L.inst.tank=H.tank;L.inst.nodes=t.call(I.node,H.nodes);return L});for(F=0;A=H.pkgs[F];F++){A.inst.proxy=x}x.pkgs=E;x.toString=v;H.fire=j;for(F=0;A=H.pkgs[F];F++){if(typeof A.pkg.def.init==="function"){A.pkg.def.init.call(A.inst,z)}}delete H.fire}m.prototype={go:function(){var I=this,v=I.nodes,G=I.tank,w,z,B,y=0,H=I.stopped,A=I.current,E=H?A.lte:-1,F=-1,C=H?I.target.index:null,D,x;if(I.loop){return !!I.target}I.posts={};I.loop=1;I.fire("begin");while(I.loop){if((H||I.target)&&!I.stop){x=0;if(C!=I.target.index||!(~E|~F)){B=A.ctx===1;E=F=-1;C=I.target.index;z=C-A.index;if(z){if((z>0&&A.index<2)||!I.target.path.indexOf(A.path)){if(B){F=A.firstChildIndex}else{E=1}}else{if(B){E=2}else{if(I.target.path.indexOf(v[A.parentIndex].path)){z=-1}if(z>0){if(A.lte==3||A.lte==2){F=A.nextIndex}else{E=3}}else{if(A.lte==4||A.lte==2){F=~A.previousIndex?A.previousIndex:A.parentIndex}else{E=4}}}}}else{E=B?0:1}}else{if(~F){if(D){D=0;I.fire("release")}else{G.currentIndex=F;I.fire("node",F,A.index);A.lte=0;A=I.current=v[F];F=-1}}else{if(!D){D=1;I.fire("engage")}else{if(!B&&(E==1||E==2)){if(E==2){E=-1}else{B=A.ctx=1}I.fire("scope",A.ctx)}else{if(H){I.fire("traversing",E)}else{A.lte=E;if(!E){I.target=0;G.targetIndex=-1}I.fire("traverse",E)}y++;if(!I.stop){I.fire("traversed",E);I.stopped=0}I.stopped=I.stop;H=0;if(E==2){B=A.ctx=0}else{E=-1}}}}}}else{if(D){D=0;I.fire("release")}else{if(!x){x=1;I.fire("end")}else{I.loop=0}}}}for(w in I.posts){if(I.posts.hasOwnProperty(w)){I.posts[w].call(d)}}return y},fire:function(v){var x="on"+v.charAt(0).toUpperCase()+v.substr(1),w=arguments,A=0,z,y;for(;z=this.pkgs[A];A++){y=z.pkg.def[x];if(typeof y=="function"){y.apply(z.inst,w)}}}};function p(y,w){var v=this.pkgs[y-1],x;if(v&&w&&typeof w==="string"){x=new v.proxy();if(typeof x[w]==="function"){return x[w]}}return j}function u(w){var x=this,A;if(arguments.length){if(typeof w==="string"&&q.test(w)){if(!x.pkgsIdx.hasOwnProperty(w)){function z(B){if(B){return B instanceof x.pkgs[A].proxy&&B.toString(x,A)}}z.getSuper=function(B){return p.call(x,A,B)};z.init=z.attrKey=z.badKey=z.onBegin=z.onEnd=z.onNode=z.onEngage=z.onRelease=z.onScope=z.onTraverse=z.onTraversing=z.onTraversed=z.prepTree=z.prepNode=0;z.label=w;function v(){}v.prototype=new x.KlassProxy();x.Klass.prototype=z.proxy=v.prototype;x.KlassProxy=v;function y(){}z.node=y.prototype;A=z.index=x.pkgsIdx[w]=x.pkgs.push({name:w,idx:x.pkgs.length,def:z,proxy:v,node:y})-1}return x.pkgs[x.pkgsIdx[w]].def}return false}return x.pkgs.map(function(B){return B.name})}function j(){}return r}if(c){define(f)}else{if(g){module.exports=f(require)}else{if(!d.Panzer){d.Panzer=f()}}}}(typeof define=="function",typeof exports!="undefined",Array,Object,RegExp,this);
!function(inAMD,inCJS,Array,Math,Object,RegExp,scope,undefined){function initFlow(require,exports,module){var Flow=(inCJS||inAMD?require("Panzer"):scope.Panzer).create(),rand_string=(Math.ceil(Math.random()*5e3)+3e3).toString(18),corePkgDef=Flow.pkg("core"),staticUnusedArray=[],protoSlice=Array.prototype.slice,RxpProto=RegExp.prototype,i,isArray=typeof Array.isArray==="function"?Array.isArray:function(obj){return obj instanceof Array},tokenPrefix="@",defaultPermissions={world:true,owner:true,sub:true},r_queryIsTokenized=new RegExp("[\\.\\|"+tokenPrefix+"]"),r_validAbsolutePath=/^\/\/(?:\w+\/)+/,r_trimSlashes=/^\/+|\/+$/g,r_hasNonAlphanumericCharacter=/\W/,r_hasAlphanumericCharacter=/\w/,r_rxpIsForPath=/^\/.*\/.*\//,traversalCallbackOrder={_on:0,_in:1,_out:2,_over:3,_bover:4,0:"_on",1:"_in",2:"_out",3:"_over",4:"_bover"},activeFlows=[],reservedQueryTokens={"null":{f:0,i:0},program:{f:0,i:1},root:{f:function(node){return node.rootIndex}},parent:{f:function(node){return node.parentIndex}},child:{f:function(node){return node.firstChildIndex}},next:{f:function(node){return node.nextIndex}},previous:{f:function(node){return node.previousIndex}},oldest:{f:function(node,nodes,tokenName){var parentNode=nodes[node.parentIndex];if(parentNode){return parentNode[(tokenName.charAt(0)==="y"?"first":"last")+"ChildIndex"]}return-1}},self:{f:function(node){return node.index}}},criteriaCache={},criteriaKeys=["has","within","on","from","is"],criteriaKeysLength=criteriaKeys.length,coreTags={_root:function(tagName,exists,tags,node,parentNode,pkg,idx){if(idx<2||exists&&tags._root){node.rootIndex=idx}else{node.rootIndex=parentNode.rootIndex}},_restrict:function(tagName,exists,tags,node,parentNode,pkg,idx){var prop=tagName.substr(1);if(exists&&tags[tagName]){node[prop]=idx}else if(parentNode){node[prop]=parentNode[prop]}else{node[prop]=-1}},_perms:function(tagName,exists,tags,node,parentNode,pkg,idx){var perms;if(exists){perms=perms_parse(tags[tagName],parentNode.lp);if(perms){node.perms=node.lp=perms}}else if(parentNode){node.perms=0;node.lp=parentNode.lp}else{pkg.perms=[node.perms=node.lp=defaultPermissions]}},_owner:function(tagName,exists,tags,node,parentNode,pkg,idx){node.oGate=0;if(exists){pkg.ownable=node.oGate=1;node.ping=tags._owner}else if(parentNode){node.ping=parentNode.ping}else{node.ping=-1}},_name:function(tagName,exists,tags,node,parentNode,pkg,idx){if(exists&&tags._name&&typeof tags._name==="string"&&!r_queryIsTokenized.test(tags._name)&&r_hasAlphanumericCharacter.test(tags._name)){pkg.tokens[tags._name]={i:idx,f:0}}},_capture:function(tagName,exists,tags,node,parentNode,pkg,idx){if(exists){node.caps=subs_sanitizeCriteria(tags._capture)}else if(parentNode){node.caps=parentNode.caps}else{node.caps=0;pkg.caps=[]}},_data:function(tagName,exists,tags,node,parentNode,pkg,idx){var cfgs={},key;node.dcfgs=[];if(exists){(isArray(tags._data)?tags._data:[tags._data]).forEach(function(data){var typeofData=typeof data,key;if(typeofData==="string"&&data){cfgs[data]={use:0,name:data,value:undefined}}if(typeofData==="object"&&data){for(key in data){if(data.hasOwnProperty(key)){cfgs[key]={use:1,name:key,value:data[key]}}}}});for(key in cfgs){if(cfgs.hasOwnProperty(key)){node.dcfgs.push(cfgs[key])}}}},_sequence:function(tagName,exists,tags,node,parentNode,pkg,idx){if(exists){node.seq=tags[tagName]?[]:0;node.lastWalk=node.seq}else{node.seq=0;if(parentNode){node.lastWalk=parentNode.lastWalk}else{node.lastWalk=0}if(node.lastWalk){node.lastWalk.push(node.index)}}},_pendable:function(tagName,exists,tags,node,parentNode,pkg,idx){if(exists){node.pendable=!!tags._pendable}else if(parentNode){node.pendable=parentNode.pendable}else{node.pendable=true}},_on:function(tagName,exists,tags,node,parentNode,pkg,idx){var tagValue=tags[tagName];if(exists&&typeof tagValue==="function"){node.fncs[traversalCallbackOrder[tagName]]=tagValue}},_tail:function(tagName,exists,tags,node,parentNode,pkg,idx){var tagValue,tailData,tailNode;if(exists){tagValue=tags._tail;node.tail=tailData={p:tagValue};if(tagValue===true){tailData.n=node}else if(tagValue===false){tailData.n=tailData.t=-1}else if(typeof tagValue==="number"&&!(tailData.n=pkg.nodes[tagValue])){tailData.t=-1}}else if(parentNode){node.tail=parentNode.tail}else{node.tail=0}},_conceal:function(tagName,exists,tags,node,parentNode,pkg,idx){node.conceal=-1;if(exists&&idx>1){if(tags._conceal){node.conceal=idx}}else if(parentNode){node.conceal=parentNode.conceal}}},corePostTags={_sequence:function(tagName,exists,tags,node){delete node.lastWalk},_tail:function(tagName,exists,tags,node,parentNode,pkg,idx){var tailData=node.tail,tailNode;node.tail=-1;if(tailData){if(!tailData.hasOwnProperty("n")){tailData.n=pkg.nodes[pkg.indexOf(tailData.p,node)]}if(!tailData.hasOwnProperty("t")){tailNode=tailData.n;if(tailNode&&!tailNode.within(node)&&(!tailNode.seq||tailNode!==node&&!node.within(tailNode))){tailData.t=tailNode.index}else{tailData.t=-1}}if(exists&&tailData.n===node){node.tail=parentNode.tail}else{node.tail=tailData.t}}},_on:function(tagName,exists,tags,node,parentNode,pkg,idx){var tgtIdx=-1,phase,typeofTagValue,tagValue;if(exists&&(typeofTagValue=typeof(tagValue=tags[tagName]))!=="function"){if(typeofTagValue==="string"&&tagValue.length){tgtIdx=pkg.indexOf(tagValue,node)}else if(typeofTagValue==="number"&&pkg.nodes[tagValue]){tgtIdx=tagValue}if(~tgtIdx&&(tagName!=="_on"||tgtIdx!==idx)){phase=traversalCallbackOrder[tagName];node.reds[phase]=tgtIdx;node.fncs[phase]=sharedRedirectEventHandler}}},_perms:function(tagName,exists,tags,node){delete node.lp}},nodeScopeActions={0:function(node,pkg){if(node.oGate&&~node.ping){pkg.pingOwner(node.ping)}},1:function(node,pkg,add){var data=pkg.proxy.data,dataCfgs=node.dcfgs,dataCfgLn=dataCfgs.length,dataCfgIdx=0,dataCfg,dataName,dataTrackingObject,scopeAction;if(!node.dcfgs.length){return}if(add){scopeAction=function(){if(data.hasOwnProperty(dataName)){dataTrackingObject.stack.unshift(data[dataName])}if(dataCfg.use){data[dataName]=dataCfg.value}else{data[dataName]=dataTrackingObject.stack[0]}}}else{scopeAction=function(){if(dataTrackingObject.stack.length){data[dataName]=dataTrackingObject.stack.shift()}else{delete pkg.dtos[dataName];delete data[dataName]}}}for(;dataCfgIdx<dataCfgLn;dataCfgIdx++){dataCfg=dataCfgs[dataCfgIdx];dataName=dataCfg.name;dataTrackingObject=pkg.getDTO(dataName);scopeAction()}},2:function(node,pkg,add){shared_nodeStackHandler(pkg.perms,node.perms,add)},3:function(node,pkg,add){shared_nodeStackHandler(pkg.caps,node.caps,add)}},nodeScopeActionsLength=4,import_pkgCnt,import_tagKeyTests,coreTagKeys=[],coreTagKeyCount,corePostTagKeys=[],corePostTagKeyCount;Flow.version="0.5.0";coreTags._ingress=coreTags._restrict;coreTags._in=coreTags._out=coreTags._over=coreTags._bover=coreTags._on;corePostTags._in=corePostTags._out=corePostTags._over=corePostTags._bover=corePostTags._on;for(i in coreTags){if(coreTags.hasOwnProperty(i)){coreTagKeys[coreTagKeys.length]=i}}coreTagKeyCount=coreTagKeys.length;for(i in corePostTags){if(corePostTags.hasOwnProperty(i)){corePostTagKeys[corePostTagKeys.length]=i}}corePostTagKeyCount=corePostTagKeys.length;reservedQueryTokens["."]=reservedQueryTokens.self;reservedQueryTokens[".."]=reservedQueryTokens.parent;reservedQueryTokens.youngest=reservedQueryTokens.oldest;function isFlow(thing){return thing instanceof Flow}function shared_nodeStackHandler(stack,item,add){if(item){if(add){stack.unshift(item)}else{stack.shift()}}}function sharedNullFunction(){}function subs_addInsts(collection,subInsts,pkg){var node=pkg.nodes[pkg.tank.currentIndex],i=0,subInst,subId,totalAdded=0;for(;subInst=subInsts[i];i++){subId=subInst.tank.id;if(!collection.hasOwnProperty(subId)){totalAdded++;collection[subId]={inst:subInst,cap:node}}}return totalAdded}function subs_removeInsts(collection,subInsts){var i=subInsts.length,subInst,subId,totalRemoved=0;while(i--){subInst=subInsts[i];subId=subInst.tank.id;if(collection.hasOwnProperty(subId)){totalRemoved++;delete collection[subId]}}return totalRemoved}function subs_getInsts(collection,criteria){var criteriaKey,criteriaKeyIdx,criteriaOption,criteriaOptions,criteriaOptionIdx,criteriaOptionsLength,passed=1,subSet,subSetId,matches=[];nextSubset:for(subSetId in collection){if(collection.hasOwnProperty(subSetId)){subSet=collection[subSetId];criteriaKeyIdx=criteriaKeysLength;nextCriteria:while(criteriaKeyIdx--){criteriaKey=criteriaKeys[criteriaKeyIdx];criteriaOptions=criteria[criteriaKey];criteriaOptionsLength=criteriaOptions.length;if(criteriaOptionsLength){for(criteriaOptionIdx=0;criteriaOptionIdx<criteriaOptionsLength;criteriaOptionIdx++){criteriaOption=criteriaOptions[criteriaOptionIdx];if(criteriaOptionIdx>=criteriaOptions.made){criteriaOption=criteriaOptions[criteriaOptionIdx]=subs_compileCriteriaOption(criteriaKey,criteriaOption,typeof criteriaOption);criteriaOptions.made++}if(criteriaOption.f(subSet,criteriaOption)){matches[matches.length]=subSet.inst;continue nextCriteria}}continue nextSubset}}}}return matches}function subs_sanitizeCriteria(raw){var criteria,criteriaKey,criteriaKeyIdx,criteriaCacheId,rxpOldToJSON,typeofRaw,isRegExp,specifiesCriteria;if(raw===null||raw===undefined){raw=false}typeofRaw=typeof raw;if(typeofRaw!=="object"||!raw.hasOwnProperty("is")){if(RxpProto.hasOwnProperty("toJSON")){rxpOldToJSON=RxpProto.toJSON}RxpProto.toJSON=subs_stainRxpInJSON;criteriaCacheId="c"+JSON.stringify(raw);if(rxpOldToJSON){RxpProto.toJSON=rxpOldToJSON}else{delete RxpProto.toJSON}if(criteriaCache.hasOwnProperty(criteriaCacheId)){return criteriaCache[criteriaCacheId]}}criteria={buffer:-1};if(typeofRaw==="boolean"&&raw){criteria.on=["/"];criteria.on.made=0}else if((isRegExp=raw instanceof RegExp)||typeofRaw==="string"&&raw||typeofRaw==="number"&&raw===~~raw){criteria.on=[raw];criteria.on.made=0}else if(typeofRaw==="object"&&!isRegExp){criteriaKeyIdx=criteriaKeysLength;while(criteriaKeyIdx--){criteriaKey=criteriaKeys[criteriaKeyIdx];if(raw.hasOwnProperty(criteriaKey)){criteria[criteriaKey]=isArray(raw[criteriaKey])?protoSlice.call(raw[criteriaKey]):[raw[criteriaKey]];criteria[criteriaKey].made=0;specifiesCriteria=1}}}criteriaKeyIdx=criteriaKeysLength;while(criteriaKeyIdx--){criteriaKey=criteriaKeys[criteriaKeyIdx];if(!criteria.hasOwnProperty(criteriaKey)){criteria[criteriaKey]=staticUnusedArray}}if(raw.hasOwnProperty("buffer")){if(!specifiesCriteria){criteria.on=["/"];criteria.on.made=0}if(raw.buffer!==-1){criteria.buffer=raw.buffer?1:0}}if(criteriaCacheId){criteriaCache[criteriaCacheId]=criteria}return criteria}subs_sanitizeCriteria(true);function subs_compileCriteriaOption(criteriaKey,value,typeofValue){var isRegExp=value instanceof RegExp,option={v:value,f:sharedNullFunction};if(criteriaKey==="has"){if(isRegExp){option.f=subs_filter_searchSetRxp;option.g=subs_filter_getSubInstMember;if(r_rxpIsForPath.test(value)){option.m="pAry"}else{option.m="sAry"}}else if(value&&typeofValue==="string"){option.g=subs_filter_getSubInstMember;if(~value.indexOf("/")){option.f=subs_filter_searchSet;option.m="pAry";if(option.v.charAt(0)!=="/"){option.v="/"+option.v}if(option.v.substr(-1)!=="/"){option.v+="/"}}else{option.f=subs_filter_matchSet;option.m="sAry"}}else if(typeofValue==="number"&&value>=0&&value===~~value){option.f=subs_filter_has_index}}else if(criteriaKey==="from"){if(isRegExp){if(r_rxpIsForPath.test(value)){option.f=subs_filter_searchRxp;option.g=subs_filter_from_path}else{option.f=subs_filter_searchSetRxp;option.g=subs_filter_from_pathParts}}else if(value&&typeofValue==="string"){if(~value.indexOf("/")){option.f=subs_filter_search;option.g=subs_filter_from_path;if(option.v.charAt(0)!=="/"){option.v="/"+option.v}if(option.v.substr(-1)!=="/"){option.v+="/"}}else{option.f=subs_filter_matchSet;option.g=subs_filter_from_pathParts}}else if(typeofValue==="number"&&value>=0&&value===~~value){option.f=subs_filter_match;option.g=subs_filter_from_index}}else if(criteriaKey==="is"){option.f=subs_filter_is}else if(criteriaKey==="on"){if(isRegExp){option.f=subs_filter_searchRxp;if(r_rxpIsForPath.test(value)){option.g=subs_filter_getStateProperty;option.m="path"}else{option.g=subs_filter_getStateProperty;option.m="name"}}else if(value&&typeofValue==="string"){if(~value.indexOf("/")){option.f=subs_filter_search;option.g=subs_filter_getStateProperty;option.m="path";if(option.v.charAt(0)!=="/"){option.v="/"+option.v}if(option.v.substr(-1)!=="/"){option.v+="/"}}else{option.f=subs_filter_match;option.g=subs_filter_getStateProperty;option.m="name"}}else if(typeofValue==="number"&&value>=0&&value===~~value){option.f=subs_filter_match;option.g=subs_filter_getStateProperty;option.m="index"}}else if(criteriaKey==="within"){if(isRegExp){if(r_rxpIsForPath.test(value)){option.f=subs_filter_searchRxp;option.g=subs_filter_within_path}else{option.f=subs_filter_searchSetRxp;option.g=subs_filter_within_pathParts}}else if(value&&typeofValue==="string"){if(~value.indexOf("/")){option.f=subs_filter_search;option.g=subs_filter_within_path;if(option.v.charAt(0)!=="/"){option.v="/"+option.v}if(option.v.substr(-1)!=="/"){option.v+="/"}}else{option.f=subs_filter_matchSet;option.g=subs_filter_within_pathParts}}else if(typeofValue==="number"&&value>-1&&value===~~value){option.f=subs_filter_within_index}}return option}function subs_stainRxpInJSON(){return rand_string+this}function subs_filter_search(subSet,params){return~params.g(subSet,params).indexOf(params.v)}function subs_filter_searchRxp(subSet,params){return params.v.test(params.g(subSet,params))}function subs_filter_searchSetRxp(subSet,params){var set=params.g(subSet,params),setIdx=set.length,rxp=params.v;while(setIdx--){if(rxp.test(set[setIdx])){return 1}}}function subs_filter_searchSet(subSet,params){var set=params.g(subSet,params),setIdx=set.length,hay,match=params.v;while(setIdx--){hay=set[setIdx];if(~hay.indexOf(match)){return 1}}}function subs_filter_match(subSet,params){return params.v===params.g(subSet,params)}function subs_filter_matchSet(subSet,params){var set=params.g(subSet,params),setIdx=set.length,match=params.v;while(setIdx--){if(set[setIdx]===match){return 1}}}function subs_filter_getSubInstMember(subSet,params){return subSet.inst[params.m]}function subs_filter_getStateProperty(subSet,params){var subInst=subSet.inst;return subInst.nodes[subInst.tank.currentIndex][params.m]}function subs_filter_is(subSet,params){return subSet.inst.nodes[1].value===params.v}function subs_filter_has_index(subSet,params){return params.v<subSet.inst.nodes.length}function subs_filter_from_path(subSet,params){return subSet.cap.path}function subs_filter_from_pathParts(subSet,params){var captureNode=subSet.cap;if(captureNode.index>1){return captureNode.path.slice(2,-1).split("/")}return staticUnusedArray}function subs_filter_from_index(subSet,params){return subSet.cap.index}function subs_filter_within_path(subSet,params){var subInst=subSet.inst,currentNode=subInst.nodes[subInst.tank.currentIndex];if(~currentNode.parentIndex){return subInst.nodes[currentNode.parentIndex].path}return""}function subs_filter_within_pathParts(subSet,params){var subInst=subSet.inst,currentNode=subInst.nodes[subInst.tank.currentIndex];if(currentNode.parentIndex>1){return subInst.nodes[currentNode.parentIndex].path.slice(2,-1).split("/")}return staticUnusedArray}function subs_filter_within_index(subSet,params){var subInst=subSet.inst,nodes=subInst.nodes,currentNode=nodes[subInst.tank.currentIndex],targetNode=nodes[params.v];if(targetNode){return currentNode.within(targetNode)}}function isDataDefinitionNameValid(name){return typeof name==="string"&&r_hasAlphanumericCharacter.test(name)}function extend(base){var argumentIdx=1,source,member;for(;source=arguments[argumentIdx];argumentIdx++){for(member in source){if(source.hasOwnProperty(member)){base[member]=source[member]}}}return base}function perms_parse(option,lastPerms){var perms,deny,typeofOption=typeof option,optionIdx,optionLength,key;if(typeofOption==="object"&&isArray(option)){optionLength=option.length;for(optionIdx=0;optionIdx<optionLength;optionIdx++){lastPerms=perms_parse(option[optionIdx],lastPerms)}}else if(typeofOption==="string"||typeofOption==="object"||typeofOption==="boolean"){perms=extend({},lastPerms);if(typeofOption==="string"&&option){deny=option.charAt(0)==="!";if(deny){option=option.substr(1)}perms[option]=!deny}else if(typeofOption==="boolean"){for(key in perms){if(perms.hasOwnProperty(key)){perms[key]=option}}}else{extend(perms,option)}return perms}return lastPerms}function import_cacheTagKeyTests(){var pkgNames=Flow.pkg();if(pkgNames.length!==import_pkgCnt){if((import_pkgCnt=pkgNames.length)===1){import_tagKeyTests=[corePkgDef.attrKey]}else{import_tagKeyTests=pkgNames.map(import_cacheTagKeyTests_map).filter(import_cacheTagKeyTests_filter)}import_tagKeyTests=import_tagKeyTests.map(import_cacheTagKeyTests_precalc)}}function import_cacheTagKeyTests_map(pkgName){return Flow.pkg(pkgName).attrKey}function import_cacheTagKeyTests_filter(tagKeyTest){return tagKeyTest}function import_cacheTagKeyTests_precalc(tagKeyTest){var typeMap={f:0,r:0};if(typeof tagKeyTest==="function"){typeMap.f=tagKeyTest}else{typeMap.r=tagKeyTest}return typeMap}function import_extractBasePath(state){var importPath;if(typeof state==="string"){importPath=state}else if(state&&state.hasOwnProperty("_import")&&typeof state._import==="string"){importPath=state._import}if(importPath&&r_validAbsolutePath.test(importPath)){return importPath}return""}function import_isState(name,value){var i=0,tagKeyTest;for(;tagKeyTest=import_tagKeyTests[i];i++){if(tagKeyTest.r&&tagKeyTest.r.test(name)||tagKeyTest.f&&tagKeyTest.f(name,value)){return 0}}return 1}function import_mergeStates_convertToObject(state){var typeofState=typeof state;if(typeofState==="string"){return{_import:state}}else if(typeofState==="function"){return{_on:state}}else if(typeofState==="object"){return state}return{}}function import_mergeStates(baseState,sourceState,mergedState){var merged=mergedState||{},base=import_mergeStates_convertToObject(baseState),source=import_mergeStates_convertToObject(sourceState),baseKeys=Object.keys(base),sourceKeys=Object.keys(source),keyIsInSource,idx=0,key;for(;key=baseKeys[idx];idx++){keyIsInSource=source.hasOwnProperty(key);if(import_isState(key)){if(keyIsInSource){merged[key]=import_mergeStates(base[key],source[key],{})}else{merged[key]=base[key]}}else if(keyIsInSource&&key!=="_import"){merged[key]=source[key]}else{merged[key]=base[key]}}for(idx=0;key=sourceKeys[idx];idx++){if(!base.hasOwnProperty(key)&&key!=="_import"){merged[key]=source[key]}}return merged}function import_getStateByAbsolutePath(path,program){var resolvedState=program;if(path.slice(2,-1).split("/").every(function(partialPath){if(resolvedState.hasOwnProperty(partialPath)&&import_isState(partialPath,resolvedState[partialPath])){resolvedState=resolvedState[partialPath];return 1}})){return resolvedState}}function import_resolveBase(sourceState,program,importedPaths){var resolvedState,baseState,importPath=import_extractBasePath(sourceState);if(importPath&&!importedPaths.hasOwnProperty(importPath)&&(baseState=import_getStateByAbsolutePath(importPath,program))){importedPaths[importPath]=1;if(typeof sourceState==="string"){resolvedState=import_mergeStates_convertToObject(baseState)}else{resolvedState=import_mergeStates(baseState,sourceState)}}return resolvedState}function sharedRedirectEventHandler(){var flow=this,pkg=corePkgDef(flow);flow.go(pkg.nodes[pkg.tank.currentIndex].reds[pkg.phase])}corePkgDef.actives=[];corePkgDef.attrKey=/^_/;corePkgDef.badKey=/^\d|^\W|[^a-zA-Z\d\-_\+=\(\)\*\&\^\%\$\#\!\~\`\{\}\"\'\:\;\?\, ]+|^toString$/;corePkgDef.prepTree=function(orig){import_cacheTagKeyTests();if(isFlow(orig)){return corePkgDef(orig).nodes[1].value}};corePkgDef.prepNode=function(state,program){var finalState,tmpState=state,importedPaths={};while(tmpState=import_resolveBase(tmpState,program,importedPaths)){finalState=tmpState}return finalState};corePkgDef.init=function(cfg){var pkg=this,activeFlow=activeFlows[0],sharedProxyDataMember={},sharedProxyStateMember={name:"_null",path:"..//",depth:0,index:0,pendable:true},nodes=pkg.nodes,nodeCount=nodes.length,i,j,node,parentNode,tagName,pkgId;pkg.bin={};pkg.tin={};pkg.nStr=pkg.pStr="|";pkg.sAry=[];pkg.pAry=[];pkg.vars={};pkg.tokens={};pkg.cq={};pkg.args=[];pkg.calls=[];pkg.locks=[0];pkg.trail=[];pkg.tgtTrail=-1;pkg.dtos={};pkg.waitTimer=pkg.waitFnc=pkg.waitArgs=0;pkg.cache={indexOf:{},store:{}};pkg.active=0;pkg.blessed=0;pkg.nids={};pkg.pending=0;pkg.pendees=[];pkg.targets=[];pkg.phase=0;pkg.owner=pkg.ownable=0;pkg.nodes[0].name="_null";pkg.nodes[1].name="_program";for(i=0;i<nodeCount;i++){node=nodes[i];parentNode=nodes[node.parentIndex];pkg.nids[node.path]=i;if(i>1){pkg.nStr+=node.name+"|";pkg.sAry[pkg.sAry.length]=node.name}pkg.pStr+=node.path+"|";pkg.pAry[pkg.pAry.length]=node.path;node.pkg=pkg;node.fncs=[0,0,0,0,0];node.reds=[];for(j=0;j<coreTagKeyCount;j++){tagName=coreTagKeys[j];coreTags[tagName](tagName,node.attrs.hasOwnProperty(tagName),node.attrs,node,parentNode,pkg,i)}if(!node.fncs[0]&&typeof node.value==="function"){node.fncs[0]=node.value}}for(i=0;i<nodeCount;i++){node=nodes[i];for(j=0;j<corePostTagKeyCount;j++){tagName=corePostTagKeys[j];corePostTags[tagName](tagName,node.attrs.hasOwnProperty(tagName),node.attrs,node,parentNode,pkg,i)}}for(pkgId in pkg.pkgs){if(pkg.pkgs.hasOwnProperty(pkgId)){pkg.pkgs[pkgId].proxy.data=sharedProxyDataMember;pkg.pkgs[pkgId].proxy.state=sharedProxyStateMember}}if(activeFlow){if(pkg.ownable){pkg.owner=activeFlow}if(activeFlow.caps[0]){subs_addInsts(activeFlow.tin,[pkg],activeFlow)}}};corePkgDef.prototype={indexOf:function(qry,node){var pkg=this,tank=pkg.tank,nodes=pkg.nodes,nids=pkg.nids,qryNode,simpleQuery,tokens,token,qryCacheId,slashSegments,slashSegmentsIdx,slashSegmentsLn,pipeSegments,pipeSegmentsIdx,pipeSegmentsLn,resolvedIndex,tokenResolver,idx=-1;node=qryNode=node||pkg.nodes[pkg.tank.currentIndex];switch(typeof qry){case"object":if(qry!==null){qry=qry.index}case"number":if(nodes[qry]){idx=qry}break;case"function":qry=qry+"";case"string":if(qry==="..//"||qry==="//"){idx=qry==="//"?1:0;break}simpleQuery=!r_queryIsTokenized.test(qry);if(qry.slice(-1)!=="/"){qry+="/"}if(qry.charAt(0)==="/"){if(qry.charAt(1)==="/"){if(simpleQuery){idx=nids[qry]||-1;break}qryNode=nodes[0]}else{qryNode=nodes[qryNode.rootIndex];if(simpleQuery){idx=nids[qryNode.path+qry.substr(1)]||-1;break}}}else if(simpleQuery){idx=nids[qryNode.path+qry]||-1;break}qry=qry.replace(r_trimSlashes,"");qryCacheId=qry+node.index;if(!pkg.cache.indexOf.hasOwnProperty(qryCacheId)){slashSegments=qry.split("/");slashSegmentsLn=slashSegments.length;resolution:for(slashSegmentsIdx=0;slashSegmentsIdx<slashSegmentsLn;slashSegmentsIdx++){pipeSegments=slashSegments[slashSegmentsIdx].split("|");pipeSegmentsLn=pipeSegments.length;for(pipeSegmentsIdx=0;pipeSegmentsIdx<pipeSegmentsLn;pipeSegmentsIdx++){token=pipeSegments[pipeSegmentsIdx];resolvedIndex=-1;if(!token){break resolution}if(r_hasNonAlphanumericCharacter.test(token)){if(token.charAt(0)===tokenPrefix){token=token.slice(1)}tokenResolver=reservedQueryTokens[token]||pkg.tokens[token];if(tokenResolver){if(tokenResolver.f){resolvedIndex=tokenResolver.f(qryNode,nodes,token)}else{resolvedIndex=tokenResolver.i}}}else{resolvedIndex=nids[qryNode.path+token+"/"]||-1}if(~resolvedIndex){qryNode=nodes[resolvedIndex];break}}if(!~resolvedIndex){break}}pkg.cache.indexOf[qryCacheId]=idx=resolvedIndex}idx=pkg.cache.indexOf[qryCacheId]}return idx},vetIndexOf:function(qry,node){var pkg=this,targetIdx=pkg.indexOf(qry,node);if(~targetIdx){if(!node){node=pkg.nodes[pkg.tank.currentIndex]}return node.canTgt(pkg.nodes[targetIdx])?targetIdx:-1}else{return-1}},getDTO:function(name){var pkg=this;if(!pkg.dtos.hasOwnProperty(name)){pkg.dtos[name]={name:name,stack:[]};if(typeof pkg.proxy.data=="object"&&pkg.proxy.data.hasOwnProperty(name)){pkg.dtos[name].stack[0]=pkg.proxy.data[name]}}return pkg.dtos[name]},go:function(){var pkg=this;pkg.preMove();return pkg.tank.go(pkg.targets[0])},preMove:function(){var pkg=this;clearTimeout(pkg.waitTimer);pkg.pause=0},is:function(){var pkg=this,activeFlow=activeFlows[0],argumentIdx=arguments.length;while(argumentIdx--){switch(arguments[argumentIdx]){case"self":if(pkg.blessed||pkg===activeFlow){return 1}break;case"owner":if(pkg.perms[0].owner&&pkg.owner===activeFlow){return 1}break;case"sub":if(activeFlow&&pkg.bin.hasOwnProperty(activeFlow.tank.id)){return 1}break;case"world":if(pkg.perms[0].world&&!pkg.is("sub","owner","self")){return 1}break}}return 0},pingOwner:function(stateQuery){var pkg=this,proxy=pkg.proxy,owner=pkg.owner;if(owner){owner.proxy.target(stateQuery,proxy,proxy.status(),extend({},proxy.state))}},setVars:function(){var pkg=this,proxy=pkg.proxy;if(proxy.hasOwnProperty("vars")){pkg.tvars=proxy.vars}proxy.vars=pkg.vars},delVars:function(){var pkg=this,proxy=pkg.proxy;if(proxy.vars!==pkg.vars&&typeof proxy.vars==="object"){pkg.vars=proxy.vars}if(pkg.hasOwnProperty("tvars")){proxy.vars=pkg.tvars;delete pkg.tvars}else{delete proxy.vars}}};corePkgDef.onBegin=function(evtName){var pkg=this;activeFlows.unshift(pkg);corePkgDef.actives.unshift(pkg.proxy);pkg.active=1;pkg.preMove();if(pkg.pending){pkg.tank.stop()}};corePkgDef.onNode=function(evtName,currentNodeIndex,lastNodeIndex){var pkg=this,state=pkg.proxy.state,currentNode=pkg.nodes[currentNodeIndex];state.name=currentNode.name;state.index=currentNode.index;state.depth=currentNode.depth;state.path=currentNode.path;state.pendable=currentNode.pendable};corePkgDef.onScope=function(evtName,entering){var pkg=this,node=pkg.nodes[pkg.tank.currentIndex];if(entering){pkg.phase=1}else{pkg.phase=2}node.scope(entering)};corePkgDef.onEngage=function(){var pkg=this;pkg.setVars()};corePkgDef.onRelease=function(){var pkg=this;pkg.delVars()};corePkgDef.onTraverse=function(evtName,phase){var pkg=this,tank=pkg.tank,node=pkg.nodes[tank.currentIndex],parentNode=pkg.nodes[node.parentIndex];pkg.phase=phase;if(!~tank.targetIndex){pkg.tgtTrail=pkg.targets.shift()}if(node.seq&&!phase){pkg.proxy.go.apply(pkg.proxy,node.seq)}if(node.fncs[phase]){pkg.calls.push(node.index+"."+phase);pkg.result=node.fncs[phase].apply(pkg.proxy,pkg.targets.length?[]:pkg.args);if(pkg.paused||pkg.pending){pkg.result=undefined}}};corePkgDef.onTraversing=function(evtName,phase){var pkg=this;if(pkg.waitFnc){pkg.waitFnc.apply(pkg.proxy,pkg.waitArgs);pkg.waitFnc=pkg.waitArgs=0}};corePkgDef.onTraversed=function(evtName,phase){var pkg=this,proxy=pkg.proxy,node=pkg.nodes[pkg.tank.currentIndex];if(node.caps){subs_addInsts(pkg.bin,subs_getInsts(pkg.tin,node.caps),pkg)}pkg.tin={};if(pkg.phase){if(~pkg.tgtTrail){pkg.trail[pkg.trail.length]=pkg.tgtTrail;pkg.tgtTrail=-1}if(!pkg.targets.length&&~node.ping){pkg.pingOwner(node.ping)}}if(typeof proxy.vars==="object"){pkg.vars=proxy.vars}proxy.vars=pkg.vars};corePkgDef.onEnd=function(evtName){var pkg=this,tank=pkg.tank,parentFlow=activeFlows[1],blocked=pkg.pause||pkg.pending||pkg.phase,hasTargets=pkg.targets.length,node=pkg.nodes[tank.currentIndex];if(!blocked&&(hasTargets||~node.tail)){if(hasTargets){tank.go(pkg.targets[0])}else{pkg.proxy.go(node.tail)}}else{if(blocked){if(parentFlow&&parentFlow.nodes[parentFlow.tank.currentIndex].pendable&&node.pendable&&!pkg.pendees[parentFlow.tank.id]){parentFlow.pending++;pkg.pendees[parentFlow.tank.id]=parentFlow;parentFlow.tank.stop()}}else{if(~node.ping){pkg.pingOwner(node.ping);if(pkg.paused||pkg.pending||pkg.targets.length){return}}pkg.args=[];pkg.calls=[];pkg.trail=[];if(!node.index){pkg.vars={}}if(pkg.pendees.length){pkg.pendees.forEach(function(pendedFlow){pendedFlow.pending--});tank.post(function(){pkg.pendees.splice(0).forEach(function(pendedFlow){if(!(pendedFlow.pending||pendedFlow.pause)){pendedFlow.go()}})})}}activeFlows.shift();corePkgDef.actives.shift();pkg.active=0}};corePkgDef.node.scope=function(entering){var node=this,pkg=node.pkg,actionIdx=nodeScopeActionsLength;while(actionIdx--){nodeScopeActions[actionIdx](node,pkg,entering)}};corePkgDef.node.canTgt=function(targetNode){var node=this,pkg=node.pkg,restrictingNode=node.pkg.nodes[this.restrict],targetIngressNode=node.pkg.nodes[targetNode.ingress];return pkg.is("sub","owner","self")||(!restrictingNode||targetNode.within(restrictingNode))&&(!targetIngressNode||node===targetIngressNode||targetNode===targetIngressNode||this.within(targetIngressNode))&&!~targetNode.conceal};corePkgDef.node.within=function(nodeRef){var parentNode=arguments.length?typeof nodeRef==="object"?nodeRef:this.pkg.nodes[nodeRef]:this.pkg.nodes[this.pkg.tank.currentIndex];return parentNode?parentNode!==this&&(!parentNode.index||!this.path.indexOf(parentNode.path)):false};corePkgDef.proxy.callbacks=function(qry,waypoint,bless){var pkg=corePkgDef(this),nodes=pkg.nodes,customCallback,cacheId;if(qry===true){qry=pkg.tank.currentIndex}waypoint=+!!waypoint;bless=+!!bless&&pkg.is("self");cacheId=""+qry+waypoint+bless;if(pkg.cq.hasOwnProperty(cacheId)){return pkg.cq[cacheId]}customCallback=function(){var rslt,setBlessed;if(bless&&!pkg.blessed){setBlessed=1;pkg.blessed=1}if(waypoint){rslt=pkg.proxy.go(qry)}else{rslt=pkg.proxy.target.apply(pkg.proxy,[qry].concat(protoSlice.call(arguments)))}if(setBlessed){pkg.blessed=0}return rslt};return pkg.cq[cacheId]=customCallback};corePkgDef.proxy.query=function(){var pkg=corePkgDef(this),nodes=[],nodeRef,argumentIdx=arguments.length,resolvedIndex;if(argumentIdx){while(argumentIdx--){nodeRef=arguments[argumentIdx];resolvedIndex=pkg.vetIndexOf(nodeRef);if(~resolvedIndex){nodes.push(pkg.nodes[resolvedIndex].path)}else{return false}}return nodes.length===1?nodes[0]:nodes.reverse()}return false};corePkgDef.proxy.perms=function(options){var pkg=corePkgDef(this),argumentsLength=arguments.length,perms;if(argumentsLength){if(pkg.is("sub","owner","self")){if(argumentsLength>1){options=protoSlice.call(arguments)}pkg.perms[0]=perms_parse(options,pkg.perms[0]);return true}return false}return extend({},pkg.perms[0])};corePkgDef.proxy.args=function(idx,value){var pkg=corePkgDef(this),pkgArgs=pkg.args,argCnt=arguments.length,isInt=typeof idx==="number"&&~~idx===idx;if(pkg.is("world","sub","owner","self")){if(argCnt===0){return[].concat(pkgArgs)}if(argCnt===1){if(isInt){return pkgArgs[idx]}if(isArray(idx)){pkg.args=[].concat(idx);return idx}}if(argCnt===2&&isInt){if(idx===pkgArgs.length-1&&value===undefined){pkgArgs.pop();return true}return pkgArgs[idx]=value}}return false};corePkgDef.proxy.target=function(qry){var pkg=corePkgDef(this),tgtIdx=pkg.is("world","sub","owner","self")?pkg.vetIndexOf(qry):-1;if(~tgtIdx){pkg.args=protoSlice.call(arguments).slice(1);pkg.targets=[tgtIdx];pkg.go()}else{return false}if(pkg.pending||pkg.pause||pkg.phase){return false}else if(pkg.active||pkg.result===undefined){return true}else{return pkg.result}};corePkgDef.proxy.go=function(waypoint){var pkg=corePkgDef(this),wasPaused=pkg.pause,waypoints=[],result=0;if(pkg.is("world","sub","owner","self")&&protoSlice.call(arguments).every(function(nodeRef){var idx=pkg.vetIndexOf(nodeRef);waypoints.push(idx);return~idx})){if(waypoints.length){while(waypoints[waypoints.length-1]===pkg.targets[0]){waypoints.pop()}pkg.targets=waypoints.concat(pkg.targets)}result=pkg.go()||wasPaused}return!!result};corePkgDef.proxy.wait=function(){var pkg=corePkgDef(this),args=arguments,argLn=args.length,noAction=argLn<2,callbackArgs=noAction?[]:protoSlice.call(args,2),delayFnc=noAction?0:args[0],isFnc=typeof delayFnc==="function",delayNodeIdx=pkg.indexOf(delayFnc),time=args[noAction?0:1];if(pkg.is("sub","owner","self")&&(!argLn||time>=0&&typeof time==="number"&&(noAction||~delayNodeIdx||isFnc))){pkg.pause=1;pkg.tank.stop();clearTimeout(pkg.waitTimer);pkg.waitTimer=argLn?setTimeout(function(){if(!noAction&&~delayNodeIdx){if(callbackArgs.length){callbackArgs.unshift(delayNodeIdx);pkg.proxy.target.apply(pkg.proxy,callbackArgs)}else{pkg.proxy.target(delayNodeIdx)}}else{if(isFnc){pkg.waitFnc=delayFnc;pkg.waitArgs=callbackArgs}pkg.go()}},~~time):1;return true}return false};corePkgDef.proxy.owner=function(owner){var argumentsLength=arguments.length,pkg=corePkgDef(this),activeFlow=activeFlows[0],readAccess=pkg.is("owner","self"),writeAccess=readAccess||!pkg.owner;if(argumentsLength){if(writeAccess){if(isFlow(owner)&&owner!==pkg.proxy){pkg.owner=corePkgDef(owner);return owner}if(owner===false){pkg.owner=0;return true}}return false}else if(readAccess){return pkg.owner.proxy}else{return!!pkg.owner}};corePkgDef.proxy.subs=function(rawCriteria){var pkg=corePkgDef(this),args=protoSlice.call(arguments),argLn=args.length,allowed=pkg.is("sub","owner","self"),tin=pkg.tin,bin=pkg.bin,criteria,results,i,subId;if(argLn>1&&rawCriteria==="remove"){if(!allowed){return 0}args.shift();if(isFlow(args[0])){i=args.length;while(i--){if(!(args[i]=corePkgDef(args[i]))){return 0}}return subs_removeInsts(bin,args)+subs_removeInsts(tin,args)}else if(argLn>1){if(argLn===2&&args[0]===null&&pkg.caps[0]){criteria=pkg.caps[0]}else{criteria=subs_sanitizeCriteria(args[0])}if(!~criteria.buffer){return subs_removeInsts(tin,subs_getInsts(tin,criteria))+subs_removeInsts(bin,subs_getInsts(bin,criteria))}else if(criteria.buffer){return subs_removeInsts(tin,subs_getInsts(tin,criteria))}else{return subs_removeInsts(bin,subs_getInsts(bin,criteria))}}return 0}if(isFlow(rawCriteria)){if(!allowed){return 0}i=argLn;while(i--){if(!(args[i]=corePkgDef(args[i]))){return 0}}subs_removeInsts(tin,args);return subs_addInsts(bin,args,pkg)}if(rawCriteria===null&&pkg.caps[0]){criteria=pkg.caps[0]}else if(argLn){criteria=subs_sanitizeCriteria(rawCriteria)}else{criteria=criteriaCache.ctrue}if(!~criteria.buffer){results=subs_getInsts(tin,criteria).concat(subs_getInsts(bin,criteria))}else if(criteria.buffer){results=subs_getInsts(tin,criteria)}else{results=subs_getInsts(bin,criteria)}i=results.length;if(allowed){while(i--){results[i]=results[i].proxy}return results}return i};corePkgDef.proxy.status=function(metric){var pkg=corePkgDef(this),currentNode=pkg.nodes[pkg.tank.currentIndex],obj={},all=!arguments.length;function getPathFromIndex(idx){return pkg.nodes[idx].path}if(all||metric==="active"){obj.active=!!pkg.active}if(all||metric==="loops"){obj.loops=Math.max((pkg.calls.join().match(new RegExp("\\b"+pkg.tank.currentIndex+"."+pkg.phase,"g"))||[]).length-1,0)}if(all||metric==="paused"){obj.paused=!!pkg.pause}if(all||metric==="phase"){obj.phase=pkg.active?traversalCallbackOrder[pkg.phase].substr(1):""}if(all||metric==="pending"){obj.pending=!!pkg.pending}if(all||metric==="targets"){obj.targets=pkg.targets.map(getPathFromIndex)}if(all||metric==="trail"){obj.trail=pkg.trail.map(getPathFromIndex)}if(all){return obj}else{return obj[metric]}};return Flow}if(inAMD){define(initFlow)}else if(inCJS){module.exports=initFlow(require,exports,module)}else if(!scope.Flow){scope.Flow=initFlow()}}(typeof define=="function",typeof exports!="undefined",Array,Math,Object,RegExp,this);