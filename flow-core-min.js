/*
Flow v0.X / Bemi Faison (c) 2011 / MIT
http://github.com/bemson/Flow/tree/nextGen

genData v0.9 / Bemi Faison (c) 2011 / MIT
http://github.com/bemson/genData/
*/
function genData(a){var b=arguments,c=b.callee,d,e,f,g,h=[],i=[],j,k,l,m=c,n;if(!(this instanceof c)){b[1]&&(h=typeof b[1]=="function"?[b[1]]:b[1]),f=h.length,b[2]&&(m=b[2]);function o(a,b){this.name=a,this.value=b}o.prototype=m.prototype,o.prototype.constructor=m,j=[["",a]];while(j.length){l=j.shift(),e=0,n=new o(l[0],l[1]),d={omit:0,scan:1,exit:0},b=[n.name,n.value,l[2],i,d];while(e<f&&!d.exit)h[e++].apply(n,b);d.omit?n._OMIT=!0:i.push(n);if(d.exit)j=[];else{k=[];if(d.scan&&typeof n.value=="object")for(g in n.value)n.value.hasOwnProperty(g)&&k.push([g,n.value[g],n]);j=k.concat(j)}}return i}if(a){~{}.toString.call(b[1]).indexOf("y")&&(m=a,b=b[1]),h=h.concat([].slice.call(b));function p(a,b,d){var e=~{}.toString.call(b).indexOf("y");if(!(this instanceof p))return c(a,h.concat(b||[]),d?d:p);if(a)return new c(e?a:p,h.concat(e?b:[].slice.call(arguments)));return this}p.prototype=new m,p.prototype.constructor=m;return p}return this}
!function(a,b,c,d){function l(){}function m(){}function n(a){function b(b){var c=b&&b.toString(f);return typeof c=="object"&&(c.pkgs.filter(function(b){return b.name===a})[0]||{}).pkg||!1}function c(){}function d(){}return b.prototype=new m,b.init=b.dataKey=b.invalidKey=b.onBegin=b.onEnd=b.onTraverse=0,c.prototype=new l,l=c,b.proxy=c.prototype,b.state=d.prototype,h[a]=g.push({name:a,pkg:b,model:c,state:d})-1,b}function o(a){var b=j(a);return b[0].parentIndex=b[0].childIndex=0,b.unshift(j()[0]),b[0].children.push(1),b[0].name="_flow",b[0].index=0,b[0].depth=0,b[0].location="..//",b[0].firstChildIndex=b[0].lastChildIndex=1,b}function p(a,b,c){var d=this;typeof c!="object"&&(c={}),d.prgm=a,d.states=o(a),d.shared={id:++e,currentIndex:0,targetIndex:-1,go:function(a){var b=~~a,c=typeof a!="object"&&d.states[b];return c&&(b>0||b==a)?(d.target=c,d.shared.targetIndex=b,d.stop=0,d.go()):!1},stop:function(){return d.stop=1,!0},post:function(a){var b;switch(typeof a){case"function":return d.posts.push(a)-1;case"number":b=~~a;if(d.posts[a])return d.posts[a]=null,!0}return!1}},d.posts=[],d.current=d.states[0],d.target=d.loop=0,d.pkgs=g.map(function(a){function f(){}var e={name:a.name};return f.prototype=new a.pkg,e.pkg=new f,e.pkg.states=k(d.states,[],a.state),typeof a.pkg.init=="function"&&a.pkg.init.call(e.pkg,c),e.pkg.tank=d.shared,e.pkg.proxy=b,e})}function q(a,b){function h(a){return a===f?e:Object.prototype.toString.apply(this,arguments)}function i(){function a(){this.pkgs=c,this.toString=h}return a.prototype=new l,a}if(this instanceof arguments.callee){var c={},d=new(i()),e=new p(a instanceof l?a.toString(f).prgm:a,d,typeof b=="object"?b:{});return g.forEach(function(a){var b=i();b.prototype=new a.model,c[a.name]=new b}),d}throw new Error('Requires "new"')}var e=0,f={},g=[],h={},i=function(a,b,c){return b.length&&g.some(function(d){var e=d.pkg[a];switch(typeof e){case"function":return e(b,c);case"object":if(e instanceof RegExp)return e.test(b)}return!1})},j=new c(function(a,b,c,e,f){var g=this,h=i("invalidKey",a,b),j=i("dataKey",a,b);h||j?(f.omit=1,f.scan=0,j&&!h&&(c.data[a]=b)):(g.inContext=g.parentIndex=g.previousIndex=g.nextIndex=g.firstChildIndex=d,g.index=e.length+1,g.depth=c?c.depth+1:1,g.name=c?a:"_root",g.data={},g.location=c?c.location+a+"/":"//",g.children=[],c&&(g.parentIndex=c.index,c.children.length||(c.firstChildIndex=g.index),g.childIndex=c.children.push(g.index)-1,c.lastChildIndex=g.index,g.childIndex&&(g.previousIndex=c.children[g.childIndex-1],e[g.previousIndex-1].nextIndex=g.index)))}),k=new c(function(a,b,c,d,e){var f=this,g;if(!c)e.omit=1;else{e.scan=0;for(g in b)b.hasOwnProperty(g)&&g!=="inContext"&&(f[g]=b[g])}});g.some||(b.prototype.some=function(a){"use strict";if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(typeof a!="function")throw new TypeError;var d=arguments[1];for(var e=0;e<c;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),g.filter||(b.prototype.filter=function(a){"use strict";if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(typeof a!="function")throw new TypeError;var d=[],e=arguments[1];for(var f=0;f<c;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),g.forEach||(b.prototype.forEach=function(a){"use strict";if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(typeof a!="function")throw new TypeError;var d=arguments[1];for(var e=0;e<c;e++)a.call(d,b[e],e,b)}),g.map||(b.prototype.map=function(a){"use strict";if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0;if(typeof a!="function")throw new TypeError;var e=new b(d),f=arguments[1];for(var g=0;g<d;g++)e[g]=a.call(f,c[g],g,c);return e}),l.prototype.constructor=q,m.prototype.inState=function(a){return a<this.states.length?!0:!1},p.prototype={go:function(){var a=this,b=a.states,c=a.shared,d,e=0,f=a.current,g=0,h=0,i;if(a.loop)return!!a.target;a.posts=[],a.loop=1,a.fire("Begin");while(a.loop)a.target&&!a.stop?(i=0,d=a.target.index-f.index,d?d>0&&f.index<2||!a.target.location.indexOf(f.location)?f.inContext?(g=0,h=f.firstChildIndex):(g=1,h=1,f.inContext=1):f.inContext?(g=1,h=2,f.inContext=0):(a.target.location.indexOf(b[f.parentIndex].location)&&(d=-1),h=d<0?4:3,f.lastEvent===2||f.lastEvent===h?(g=0,h=d>0?f.nextIndex:f.previousIndex||f.parentIndex):g=1):(g=1,h=f.inContext?0:1,f.inContext&&(a.target=0,c.targetIndex=-1),f.inContext=1),g?(f.lastEvent=h,e++,a.fire("Traverse",[h])):(f.lastEvent=0,f=a.current=b[h],c.currentIndex=h)):!i&&(a.stop||!a.target)?(i=1,a.fire("End")):a.loop=0;return a.posts.forEach(function(a){typeof a=="function"&&a()}),e},fire:function(a,b){b=b||[],b.unshift(a.toLowerCase()),a="on"+a,this.pkgs.forEach(function(c){var d=g[h[c.name]].pkg[a];typeof d=="function"&&d.apply(c.pkg,b)})}},q.pkg=function(a){return arguments.length?typeof a=="string"&&/\w/.test(a)?(h.hasOwnProperty(a)||n(a),g[h[a]].pkg):!1:g.map(function(a){return a.name})},a.Flow=q}(this,Array,genData)
!function(a,b,c,d,e,f){var g=e.pkg("core"),h=function(a){var c=typeof a;return c==="object"&&~(new b).toString.call(a).indexOf("y")?"array":c},i=new genData(function(a,b,d,e,g){var h=this;h.O=typeof b=="object",h.A=b instanceof c,h.V=1,d?d.A?h.O&&(g.exclude=1):g.scanValue=0:h.O&&(g.exclude=1);if(!g.exclude){if(!d||d.A)h.name=b,h.value=f,h.V=0;if(h.name==null||!/\w/.test(h.name))g.exclude=1;g.exclude||e.filter(function(a,b){return a.name===h.name&&((a.I=b)||1)}).forEach(function(a){e.splice(a.I,1)})}}),j=new genData(function(a,b,c,d,e){var f=this,g="/";f.set=0,f.parent=c,f.done=0,typeof b=="string"&&(~b.indexOf(g)?f.value=b.split(g):b.charAt(0)==="["&&(f.value=b.slice(1,-1).split("|"),f.set=1)),typeof f.value=="string"?(c&&c.set&&(f.set=1,c.last=f),f.first=!d.length):e.omit=1}),k=[];k.every||(c.prototype.every=function(a){"use strict";if(this===void 0||this===null)throw new TypeError;var c=b(this),d=c.length>>>0;if(typeof a!="function")throw new TypeError;var e=arguments[1];for(var f=0;f<d;f++)if(!a.call(e,c[f],f,c))return!1;return!0}),g.events="on|in|out|over".split("|"),g.dataKey=/^_/,g.invalidKey=/^\W+$|^toString$|^[@\[]|[\/\|]/,g.init=function(){var a=this;a.args=[],a.calls=[],a.route=[],a.vars={},a.delay={},a.cache={indexOf:{}},a.locked=0,a.stateIds={},a.pending=0,a.parentFlows=[],a.targets=[],a.phase=0,a.states.forEach(function(b,c){var d=c&&a.states[b.parentIndex];a.stateIds[b.location]=c,b.fncs=[],b.pendable=d&&!d.pendable?0:b.data.hasOwnProperty("_pendable")?!!b.data._pendable:1,b.isRoot=c<2?1:!!b.data._root,b.rootIndex=b.isRoot?b.index:d.rootIndex,b.restrictPath=b.data._restrict?b.location:d?d.restrictPath:"",b.map=function(){return a.proxy.pkgs.core.target(c,arguments)},b.vars=i(b.data._vars).map(function(a){return{name:a.name,value:a.value,use:a.V}}),b.index&&(d.map[b.name]=b.map),b.map.toString=function(){return b.location},g.events.forEach(function(a,c){a="_"+a,b.fncs[c]=typeof b.data[a]=="function"?b.data[a]:0}),!b.fncs[0]&&typeof b.value=="function"&&(b.fncs[0]=b.value)})},g.prototype={indexOf:function(a,b){var c=this,d=c.states,e=c.stateIds,f,g,h,i,k,l=-1;b=b||c.states[c.tank.currentIndex];switch(typeof a){case"object":a!==null&&(a=a.index);case"number":d[a]&&(l=a);break;case"function":a=a+"";case"string":if(a==="..//"||a==="//")l=a==="//"?1:0;else{i=a.match(/^(?:(?:\.{1,2}|[@\[][^\/]+)\/?)+/);if(i){if(!c.cache.indexOf.hasOwnProperty(a+b.index)&&!c.cache.indexOf.hasOwnProperty(a)){f=a.substr(i[0].length),h=0,i=j(i[0]),l=b.index;while((g=d[l])&&i.length){k=i.shift();if(!k.set||!k.parent.done){switch(k.value){case"@child":l=g.firstChildIndex;break;case"@next":l=g.nextIndex;break;case"@parent":case"..":l=g.parentIndex;break;case"@previous":l=g.previousIndex;break;case"@root":l=g.rootIndex;break;case"@program":case"@flow":k.first&&(h=1),l=~k.value.indexOf("f")?0:1;break;case"@oldest":case"@youngest":l=d[g.parentIndex]?d[g.parentIndex][~k.value.indexOf("y")?"firstChildIndex":"lastChildIndex"]:-1;break;case"@self":case".":l=g.index;break;default:k.value&&(l=-1)}k.set&&(l>-1?k.parent.done=1:k.parent.last!==k&&(l=g.index))}}l=g&&(!f||(g=d[e[g.location+f.replace(/([^\/])$/,"$1/")]]))?g.index:-1,c.cache.indexOf[a+(h?"":b.index)]=l}l=c.cache.indexOf.hasOwnProperty(a+b.index)?c.cache.indexOf[a+b.index]:c.cache.indexOf[a]}else a.charAt(0)!=="/"?a=b.location+a:a.charAt(1)!=="/"&&(a=d[b.rootIndex].location+a.substr(1)),a.slice(-1)!=="/"&&(a+="/"),l=e.hasOwnProperty(a)?e[a]:-1}}return l},vetIndexOf:function(a,b){var c=this,d=c.indexOf(a,b);return b=b||c.states[c.tank.currentIndex],~d&&(c.trust||!c.states[d].location.indexOf(b.restrictPath))?d:-1},getVar:function(a,b){var c=this;return c.vars.hasOwnProperty(a)?c.vars[a]:c.vars[a]={name:a,values:arguments.length>1?[b]:[]}},scopeVars:function(a,b){var c=this;a.vars.forEach(function(a){var d=c.getVar(a.name);b?(d.values.shift(),d.values.length||delete c.vars[a.name]):d.values.unshift(a.use?a.value:d.values[0])})},go:function(a){var b=this;return a>-1&&(b.targets=[a]),b.pause=0,b.pending||b.locked&&!b.trust?0:b.tank.go(b.targets[0])}},g.onBegin=function(){var b=this,c=b.delay.callback,d=k[0];d&&d.states[d.tank.currentIndex].pendable&&(d.pending++,~b.parentFlows.indexOf(d)||b.parentFlows.unshift(d)),k.unshift(b),a.clearTimeout(b.delay.timer),b.delay.callback=0,c&&(b.trust=1,c.call(b.proxy),b.trust=0)},g.onTraverse=function(a){var b=this,c=b.states[b.tank.currentIndex];b.trust=1,b.outState&&(b.scopeVars(b.outState,1),b.outState=0);switch(a){case 1:b.scopeVars(c);break;case 2:b.outState=c}b.phase=a,c.index!==b.route.slice(-1)[0]&&b.route.push(c.index),c.fncs[a]&&(b.calls.push(c.index+"."+a),b.result=c.fncs[a].apply(b.proxy,a||b.targets.length-1?[]:b.args)),b.pending&&b.tank.stop(),b.trust=0},g.onEnd=function(){var a=this,b=a.pause||a.pending;a.phase?k.shift():(~a.tank.targetIndex||a.targets.shift(),!b&&a.targets.length?a.tank.go(a.targets[0]):(k.shift(),b||(a.args=[],a.calls=[],a.route=[],a.parentFlows.length&&(a.parentFlows.forEach(function(b){a.parentFlows.pending--}),a.tank.post(function(){var b=[].concat(a.parentFlows);a.parentFlows=[],b.forEach(function(a){--a.pending||(a.phase?a.go():a.tank.go())})})))))},g.proxy.map=function(a){var b=g(this),c=1,e;if(arguments.length){e=b.indexOf(a);if(~e)c=d.max(c,e);else return!1}return b.states[c].map},g.proxy.query=function(a){var b=g(this),c=[];return a&&[].slice.call(arguments).every(function(a){var d=b.vetIndexOf(a),e=0;return~d&&(c.push(b.states[d].location),e=1),e})?c.length>0?c:c[0]:!1},g.proxy.lock=function(a){var b=g(this),c=!1;return arguments.length?b.trust&&(b.locked=!!a,c=!0):c=!!b.locked,c},g.proxy.vars=function(a,b){var c=g(this),d=arguments.length,e,f=!1;if(d)typeof a=="string"&&/\w/.test(a)&&(e=c.getVar(a),d>1?(e.values[0]=b,f=!0):f=e.values[0]);else{f=[];for(e in c.vars)c.vars.hasOwnProperty(e)&&f.push(e);f.sort()}return f},g.proxy.args=function(a,b){var c=g(this),d=c.args,e=d.length,i=arguments.length,j=h(a),k=!0;return i&&!c.locked?j==="array"?c.args=[].concat(a):j==="number"?i>1?b===f&&a===e-1?d.pop():d[a]=b:a>-1&&a<e?k=d[a]:k=!1:k=!1:i||(k=d.concat()),k},g.proxy.target=function(a){var b=g(this),c=b.vetIndexOf(a),d=0;return~c&&(b.args=[].slice.call(arguments).slice(1),b.go(c),d=b.pending||b.phase||b.pause?0:b.result===f?1:b.result),!!d},g.proxy.go=function(){var a=g(this),b=a.targets,c=a.pause,d=[],e,f=0;if([].slice.call(arguments).every(function(b){var c=a.vetIndexOf(b);return d.push(c),~c})){if(e=d.length)b.length?(d[e-1]===b[a.phase?0:1]&&d.pop(),a.phase?b=d.concat(b):b.splice.apply(b,[0,1].concat(d))):b=d,a.targets=b;f=a.go()||c}return!!f},g.proxy.wait=function(){var b=g(this),c=arguments,d=c.length,e=d<2,f=e?0:c[0],h=typeof f=="function",i=b.indexOf(f),j=~~c[d-1],k=0;return b.trust&&(!d||j>-1&&(e||~i||h))&&(b.pause=1,b.tank.stop(),a.clearTimeout(b.delay.timer),b.delay.timer=d?a.setTimeout(function(){!e&&~i?b.go(i):(h&&(b.delay.callback=f),b.go())},j):1,k=1),!!k},g.proxy.status=function(){var a=this,b={};return e.pkg().forEach(function(c){var d=e.pkg(c),f,g;if(typeof d.addStatus=="function"){f=d.addStatus.call(d(a),b);for(g in f)f.hasOwnProperty(g)&&(b[g]=f[g])}}),b},g.addStatus=function(a){var b=this,c=b.states[b.tank.currentIndex],e=b.targets.length,f=b.pause||e||b.pending,h=function(a){return b.states[a].location};return{trust:!!b.trust,loops:d.max((b.calls.join().match(new RegExp("\\b"+c.index+"."+b.phase,"g"))||[]).length-1,0),depth:c.depth,paused:!!b.pause,pending:!!b.pending,pendable:!!c.pendable,targets:b.targets.map(h),route:f?b.route.map(h):[],location:c.location,index:c.index,phase:f?g.events[b.phase]:"",state:c.name}}}(this,Object,Array,Math,Flow)